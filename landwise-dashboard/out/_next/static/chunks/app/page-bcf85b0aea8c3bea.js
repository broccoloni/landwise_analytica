(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7225:function(e,a,t){Promise.resolve().then(t.bind(t,2007))},2007:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return el}});var s=t(7437),l=t(8022),r=t.n(l),i=t(9436),n=t.n(i),c=t(8693),d=t.n(c),o=t(2265),m=e=>{let{children:a,className:t}=e;return(0,s.jsx)("div",{className:"bg-white ".concat(t," rounded-lg border p-8"),children:a})},h=e=>{let{addressComponents:a,latitude:t,longitude:l}=e;return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Address:"}),(0,s.jsxs)("p",{children:[a.street_number," ",a.route]})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Locality:"}),(0,s.jsx)("p",{children:a.locality})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Postal Code:"}),(0,s.jsx)("p",{children:a.postal_code})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"State / Province:"}),(0,s.jsx)("p",{children:a.administrative_area_level_1})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"County:"}),(0,s.jsx)("p",{children:a.administrative_area_level_2})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Country:"}),(0,s.jsx)("p",{children:a.country})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Longitude:"}),(0,s.jsx)("p",{children:l})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Latitude:"}),(0,s.jsx)("p",{children:t})]})]})},x=t(7818);let u=(0,x.default)(()=>Promise.all([t.e(934),t.e(8)]).then(t.bind(t,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});var v=()=>{let e=["Estimated Yield","Climate","Topography"],a=[96,92,86],t=a.reduce((e,a)=>e+a,0)/a.length,l=[...a,a[0]],i=[...e,e[0]];return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-2xl"),children:"Score: ".concat(Math.round(t),"%")}),(0,s.jsx)("div",{className:"",style:{height:"300px"},children:(0,s.jsx)(u,{data:[{type:"scatterpolar",r:l,theta:i,fill:"toself",marker:{color:"var(--accent)"},line:{shape:"spline",smoothing:.8,color:"var(--accent)",width:3},fillcolor:"rgba(0,0,0, 0.1)",hoverinfo:"none"}],layout:{polar:{radialaxis:{visible:!0,range:[0,100],tickfont:{size:14,color:"#333",family:r().style.fontFamily},gridcolor:"#ccc"},angularaxis:{tickfont:{size:14,color:"#444",family:r().style.fontFamily},linecolor:"#888"}},margin:{t:20,l:160,r:120,b:20},showlegend:!1,paper_bgcolor:"#fff",plot_bgcolor:"#f5f5f5",dragmode:!1},useResizeHandler:!0,style:{width:"100%",height:"100%"}})})]})},f=e=>{let{options:a,selected:t,onSelect:l,className:r}=e,[i,n]=(0,o.useState)(!1),c=(0,o.useRef)(null);return(0,o.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&n(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.jsxs)("div",{className:"relative inline-block z-10 ".concat(r),ref:c,children:[(0,s.jsxs)("button",{onClick:()=>n(!i),className:"flex items-center p-2 bg-gray-200 text-black rounded focus:outline-none",children:[t,(0,s.jsx)("span",{className:"flex justify-center items-center ml-2 pl-2",children:(0,s.jsx)("span",{className:"w-0 h-0 border-l-4 border-l-transparent border-t-4 border-t-black border-r-4 border-r-transparent"})})]}),i&&(0,s.jsx)("ul",{className:"absolute z-10 min-w-24 bg-white border border-gray-300 rounded shadow-lg mt-1",children:a.map((e,t)=>(0,s.jsx)("li",{onClick:()=>{l(e),n(!1)},className:"p-2 cursor-pointer hover:bg-accent-medium hover:text-white border-b border-gray-300 ".concat(t===a.length-1?"border-b-0":""),children:e},e))})]})},j=t(3274);function p(){return(0,s.jsx)("div",{className:"flex justify-center h-full w-full my-20",children:(0,s.jsx)(j.Z,{className:"h-20 w-20 animate-spin text-black"})})}var b=t(8579),g=t.n(b),N=e=>{let{vmin:a,vmax:t,numIntervals:l=5,heatmapColors:r}=e,i=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=i.current;if(!e){console.error("Canvas element not found");return}let s=e.getContext("2d");if(!s)throw Error("Failed to get canvas 2D context");let l=g().scale(r).domain([t,a]);for(let r=0;r<e.height;r++){let i=l(a+r/e.height*(t-a)).hex();s.fillStyle=i,s.fillRect(0,r,e.width,1)}},[a,t,r]);let n=((e,a,t)=>{let s=(a-e)/(t-1),l=[];for(let a=0;a<t;a++)l.push(e+a*s);return l})(a,t,l);return(0,s.jsxs)("div",{className:"flex justify-center items-center",children:[(0,s.jsx)("canvas",{ref:i,width:30,height:300,className:"border border-gray-300"}),(0,s.jsx)("div",{className:"flex flex-col justify-between ml-2 h-full",children:n.reverse().map((e,a)=>(0,s.jsx)("span",{children:e>5?e.toFixed(1):e.toFixed(5)},a))})]})},y=e=>{let{headers:a,data:t}=e;return(0,s.jsxs)("table",{className:"min-w-full border-collapse mb-4",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:a.map((e,a)=>(0,s.jsx)("th",{className:"".concat(n().className," px-4 py-2 font-normal ").concat(0===a?"text-left":"text-right"),children:e},a))})}),(0,s.jsx)("tbody",{children:t.map((e,a)=>(0,s.jsx)("tr",{children:Object.values(e).map((e,a)=>(0,s.jsx)("td",{className:"px-4 py-2 ".concat(0===a?"text-left":"text-right"),children:e},a))},a))})]})};let w=["Flaxseed","Wheat","Barley","Oats","Canola","Peas","Corn","Soy"],S=e=>{let a=e.filter(e=>null!==e);return 0===a.length?0:a.reduce((e,a)=>e+a,0)/a.length},D=e=>{let a=e.filter(e=>null!==e);if(0===a.length)return 0;let t=S(a);return Math.sqrt(a.reduce((e,a)=>e+Math.pow(a-t,2),0)/a.length)},M=(0,x.default)(()=>Promise.all([t.e(934),t.e(8)]).then(t.bind(t,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1}),E=(0,x.default)(()=>Promise.all([t.e(733),t.e(212),t.e(969)]).then(t.bind(t,1969)),{loadableGenerated:{webpack:()=>[1969]},ssr:!1});var C=e=>{let{lat:a,lng:t,rasterDataCache:l,elevationData:r,cropHeatMaps:i,yearlyYields:c,climateData:m,score:h,setScore:x}=e,[u,v]=(0,o.useState)({});(0,o.useEffect)(()=>{let e=Object.values(u).map(Number);3===e.length&&x(Math.round(S(e)))},[u]);let[j,b]=(0,o.useState)({}),[g,C]=(0,o.useState)({}),[F,k]=(0,o.useState)({}),[P,O]=(0,o.useState)("Flaxseed"),[G,A]=(0,o.useState)({}),[Y,T]=(0,o.useState)(""),[L,U]=(0,o.useState)(""),[_,B]=(0,o.useState)("Flaxseed"),[I,W]=(0,o.useState)([]);(0,o.useEffect)(()=>{if(l){let t=Object.keys(l).filter(e=>"elevation"!==e).map(Number);t.length>0&&W(l[t[0]].bbox);let s={};for(let r of t){var e,a;let t=null===(a=l[r])||void 0===a?void 0:null===(e=a.majorCommodityCropsGrown)||void 0===e?void 0:e[0];t&&(s[r]=t)}C(s)}},[l]),(0,o.useEffect)(()=>{if(c&&g){let i={},n=[],d=[],o={},m={},h=Object.keys(g).map(Number);for(let t of Array.from(new Set(c.map(e=>Number(e.Year)).filter(e=>e>=2014&&e<=2034))))for(let s of w){let l=c.find(e=>e.Crop===s&&e.Year===t&&"Property"===e.levels),r=c.find(e=>e.Crop===s&&e.Year===t&&"Neighbourhood"===e.levels),x=c.find(e=>e.Crop===s&&e.Year===t&&"National"===e.levels),u=(null==l?void 0:l.Yield)||0,v=(null==r?void 0:r.Yield)||0,f=(null==x?void 0:x.Yield)||0;var e=0,a=0;v>0&&(e=u/v),f>0&&(a=u/f),h.includes(Number(t))?s===g[Number(t)]&&(n.push(e),d.push(a),i[Number(t)]={label:"".concat(t," - ").concat(s),property:u,neighbourhood:v,national:f}):(s in o||(o[s]=[]),Array.isArray(o[s])&&o[s].push(e),s in m||(m[s]=[]),Array.isArray(m[s])&&m[s].push(a))}b(i);let x=Math.round(100*S(n)),u=Math.round(100*D(n)),f=Math.round(100*S(d)),j=Math.round(100*D(d));k({histNeighbourhoodPerf:"".concat(x," % \xb1 ").concat(u," %"),histNationalPerf:"".concat(f," % \xb1 ").concat(j," %")});let p=Math.min((f+x)/2,100);p>0&&v(e=>e.histScore?e:{...e,histScore:Math.round(p)});let N={};var t="",s=0,l="",r=1e6;w.forEach(e=>{let a=o[e]||[],i=m[e]||[],n=100*S(a),c=100*D(a),d=100*S(i),h=100*D(i),x=(n+d)/2,u="".concat(n.toFixed(0)," % \xb1 ").concat(c.toFixed(0)," %"),v="".concat(d.toFixed(0)," % \xb1 ").concat(h.toFixed(0)," %");N[e]={neighbourhoodPerf:u,nationalPerf:v,avgPerf:x},x>s&&(t=e,s=x),x<r&&(l=e,r=x)}),A(N),T(t),U(l)}},[c,g]);let H=Object.keys(j).map(e=>j[e].label),R=Object.keys(j).map(e=>j[e].property),z=Object.keys(j).map(e=>j[e].neighbourhood),Z=Object.keys(j).map(e=>j[e].national),V=c.filter(e=>e.Crop===P&&e.Year>=2014&&e.Year<=2034).filter(e=>["Property","Neighbourhood","National"].includes(e.levels)).reduce((e,a)=>{let t=e.findIndex(e=>e.name===a.levels);return -1!==t?(e[t].x.push(a.Year),e[t].y.push(a.Yield)):e.push({x:[a.Year],y:[a.Yield],name:a.levels,mode:"lines"}),e},[]),[J,q]=(0,o.useState)(null);return(0,o.useEffect)(()=>{i&&_&&q(i[_])},[_,i]),(0,o.useEffect)(()=>{if(G){var e;let a=Object.keys(G).sort((e,a)=>G[a].avgPerf-G[e].avgPerf),t=Math.min(null===(e=G[a[0]])||void 0===e?void 0:e.avgPerf,100);t>0&&v(e=>e.futScore?e:{...e,futScore:Math.round(t)})}},[G]),(0,o.useEffect)(()=>{if(i){let e=Object.entries(i).map(e=>{let[a,t]=e,{average:s,stdDev:l}=t;return{cropName:a,ncv:0!==s?Math.max(0,Math.min(1,l/s)):1,average:s,stdDev:l}});if(e.length>0){let a=Math.min((1-e.sort((e,a)=>e.ncv-a.ncv)[0].ncv)*100,100);a>0&&v(e=>e.consScore?e:{...e,consScore:Math.round(a)})}}},[i]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"".concat(d().className," flex text-accent-dark text-2xl pb-2"),children:[(0,s.jsx)("div",{className:"",children:"Estimated Yield"}),h&&(0,s.jsxs)("div",{className:"",children:[" - ",h,"%"]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Estimated Historic Yield"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("div",{className:"w-[40%] mt-8 p-4",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Performance Comparison"}),(0,s.jsxs)("div",{className:"flex justify-between mb-2 mx-4",children:[(0,s.jsx)("div",{className:"",children:"Crops Grown:"}),g&&(0,s.jsx)("div",{children:Object.values(g).filter((e,a,t)=>t.indexOf(e)===a).join(", ")})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2 mx-4",children:[(0,s.jsx)("div",{className:"",children:"Average Yield vs Neighbourhood:"}),(0,s.jsx)("div",{className:"",children:F.histNeighbourhoodPerf})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2 mx-4",children:[(0,s.jsx)("div",{className:"",children:"Average Yield vs National:"}),(0,s.jsx)("div",{className:"",children:F.histNationalPerf})]})]}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row justify-center items-center w-full",children:[(0,s.jsx)("div",{className:"".concat(n().className," w-full text-center"),children:"Estimated Historic Yield"}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(M,{data:[{x:H,y:R,name:"Property",type:"bar",marker:{color:"#708090"}},{x:H,y:z,name:"Neighbourhood",type:"bar",marker:{color:"#8FBC8F"}},{x:H,y:Z,name:"National",type:"bar",marker:{color:"#B0C4DE"}}],layout:{barmode:"group",xaxis:{title:"Year & Crop Grown",tickangle:-45},yaxis:{title:"Yield (Bushels/Acre)"},legend:{title:{text:"Administrative Level"}},margin:{t:0,b:100,l:50,r:0}},useResizeHandler:!0,style:{width:"100%",height:"100%"}})})]})})]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Estimated Projected Yield"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%] mt-8 p-4",children:(0,s.jsx)(()=>{if(!G)return null;let e=Object.keys(G).sort((e,a)=>G[a].avgPerf-G[e].avgPerf),a=e.filter(e=>G[e].avgPerf>100).length,t=e.map(e=>({crop:e,neighbourhoodPerf:G[e].neighbourhoodPerf,nationalPerf:G[e].nationalPerf}));return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 ml-4"),children:"Average Future Yield Comparison"}),(0,s.jsx)(y,{headers:["Crop","Neighbourhood","National"],data:t}),(0,s.jsxs)("div",{className:"flex justify-between mx-4 mb-2",children:[(0,s.jsx)("div",{className:"",children:"Highest Performing Projected Crop:"}),(0,s.jsx)("div",{className:"",children:Y})]}),(0,s.jsxs)("div",{className:"flex justify-between mx-4 mb-2",children:[(0,s.jsx)("div",{className:"",children:"Lowest Performing Projected Crop:"}),(0,s.jsx)("div",{className:"",children:L})]}),(0,s.jsxs)("div",{className:"flex justify-between mx-4",children:[(0,s.jsx)("div",{className:"",children:"Crops with Average Performance Above 100%:"}),(0,s.jsx)("div",{className:"",children:a})]})]})},{})}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row justify-center items-center w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-4"),children:"Estimated Projected Yield for:"}),(0,s.jsx)(f,{options:w,selected:P,onSelect:O})]}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(M,{style:{width:"100%",height:"100%"},className:"mt-0",data:V,layout:{xaxis:{title:"Year"},yaxis:{title:"Yield (Bushels/Acre)"},margin:{t:10,b:50,l:50,r:0},shapes:[{type:"line",x0:2024,x1:2024,y0:0,y1:1,xref:"x",yref:"paper",line:{color:"grey",dash:"dash"}}]}})})]})})]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Yield Consistency Across Property"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%] mt-8 p-4",children:(0,s.jsx)(()=>{if(!i)return null;let e=Object.entries(i).map(e=>{let[a,t]=e,{average:s,stdDev:l}=t;return{cropName:a,ncv:0!==s?Math.max(0,Math.min(1,l/s)):1,average:s,stdDev:l}});if(0===e.length)return null;let a=e.sort((e,a)=>e.ncv-a.ncv),t=a[0],l=a[a.length-1];return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Average Yield Across Property (Bushels/Acre)"}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(y,{headers:["Crop Name","Average","Coef. of Variation"],data:e.map(e=>{let{cropName:a,ncv:t,average:s,stdDev:l}=e;return{cropName:a,average:"".concat(s.toFixed(2)," \xb1 ").concat(l.toFixed(2)),ncv:t.toFixed(3)}})})}),(0,s.jsxs)("div",{className:"mt-4 mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{children:"Most Consistent Crop:"}),(0,s.jsx)("div",{children:t.cropName})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{children:"Least Consistent Crop:"}),(0,s.jsx)("div",{children:l.cropName})]})]})]})},{})}),(0,s.jsx)("div",{className:"w-[60%]",children:J&&_&&I?(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center h-16",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-4"),children:"Yield Heatmap for:"}),(0,s.jsx)(f,{options:w,selected:_,onSelect:B})]}),(0,s.jsx)(E,{latitude:a,longitude:t,zoom:15,bbox:I,imageUrl:J.imageUrl})]}),(0,s.jsxs)("div",{className:"flex-row ml-2 justify-start items-center mt-16",children:[(0,s.jsx)("div",{className:"".concat(d().className," text-center"),children:"Yield"}),(0,s.jsx)("div",{className:"mb-2",children:"(Bushels/Acre)"}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(N,{vmin:J.thresholdMin,vmax:J.thresholdMax,numIntervals:5,heatmapColors:["black","red","yellow","white"]})})]})]}):(0,s.jsx)(p,{})})]})]})]})},F=t(14);let k=e=>{let a=new Date(2024,0,1);return a.setDate(a.getDate()+e),a.toISOString().split("T")[0].slice(5)},P=["Jan.","Feb.","Mar.","Apr.","May","June","July","Aug.","Sep.","Oct.","Nov.","Dec."],O=e=>{let a=new Date(e),t=P[a.getMonth()],s=a.getDate();return"".concat(t," ").concat(s)},G=e=>{if(isNaN(Number(e)))return e;let a=O(k((e-1)*7)),t=O(k(7*e));return"".concat(a," - ").concat(t)},A=(0,x.default)(()=>Promise.all([t.e(934),t.e(8)]).then(t.bind(t,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});var Y=e=>{let{lat:a,lng:t,rasterDataCache:l,elevationData:r,cropHeatMaps:i,yearlyYields:c,climateData:m,score:h,setScore:x}=e,[u,v]=(0,o.useState)({});(0,o.useEffect)(()=>{let e=Object.values(u).map(Number);3===e.length&&x(Math.round(S(e)))},[u]);let[f,j]=(0,o.useState)(null),[p,b]=(0,o.useState)(null),[g,N]=(0,o.useState)(null),[y,w]=(0,o.useState)(null),[M,E]=(0,o.useState)(null),[C,P]=(0,o.useState)(null),[Y,T]=(0,o.useState)(null),[L,U]=(0,o.useState)(null),[_,B]=(0,o.useState)(null),[I,W]=(0,o.useState)(null),[H,R]=(0,o.useState)(null),[z,Z]=(0,o.useState)(null),[V,J]=(0,o.useState)(null),[q,K]=(0,o.useState)(null),[Q,$]=(0,o.useState)(null),[X,ee]=(0,o.useState)([]),[ea,et]=(0,o.useState)(""),[es,el]=(0,o.useState)(""),[er,ei]=(0,o.useState)(""),[en,ec]=(0,o.useState)(""),[ed,eo]=(0,o.useState)(""),[em,eh]=(0,o.useState)("");(0,o.useEffect)(()=>{if(m){let r=Object.keys(m).map(Number);j(r),null===p&&b(r[0]),null===y&&w(r[0]);var e=[],a=[],t=[],s=[],l=[];r.forEach(r=>{let i=m[r];if(console.log(i),Object.values(i.cornHeatUnits).length>=365){let r=Math.max(...Object.values(i.cornHeatUnits)),n=Math.max(...Object.values(i.GDD0)),c=Math.max(...Object.values(i.GDD5)),d=Math.max(...Object.values(i.GDD10)),o=Math.max(...Object.values(i.GDD15));e.push(r),a.push(n),t.push(c),s.push(d),l.push(o)}}),P(Math.round(S(e))),T(Math.round(D(e))),U(Math.round(S(a))),B(Math.round(D(a))),W(Math.round(S(t))),R(Math.round(D(t))),Z(Math.round(S(s))),J(Math.round(D(s))),K(Math.round(S(l))),$(Math.round(D(l)));let i=e=>{let a=new Date(e.getFullYear(),0,0);return Math.floor((e.getTime()-a.getTime())/864e5)+1},n=r.map(e=>{let a=m[e];if(!(null==a?void 0:a.lastFrost)||!(null==a?void 0:a.firstFrost))return null;let t=new Date(a.lastFrost),s=new Date(a.firstFrost);return{year:e,length:null==a?void 0:a.growingSeasonLength,start:i(t),end:i(s),lastFrost:null==a?void 0:a.lastFrost,firstFrost:null==a?void 0:a.firstFrost}}).filter(e=>null!==e&&null!==e.length);if(ee(n),n.length>0){let e=n.map(e=>e.end),a=n.map(e=>e.start),t=n.map(e=>e.length).filter(e=>null!==e),s=Math.min(...e),l=Math.max(...e);et(O(k(s))),el(O(k(l)));let r=Math.min(...a),i=Math.max(...a);ei(O(k(r))),ec(O(k(i))),eo("".concat(Math.min(...t)," days")),eh("".concat(Math.max(...t)," days"))}}},[m]);let ex=(e,a)=>({x:Object.keys(e),y:Object.values(e),type:"scatter",mode:"lines+markers",name:a});return(0,o.useEffect)(()=>{if(m&&y){let e=m[y];E([ex(e.cornHeatUnits,"CHU"),ex(e.GDD0,"GDD - Base Temp. 0\xb0C"),ex(e.GDD5,"GDD - Base Temp. 5\xb0C"),ex(e.GDD10,"GDD - Base Temp. 10\xb0C"),ex(e.GDD15,"GDD - Base Temp. 15\xb0C")])}},[y,m]),(0,o.useEffect)(()=>{if(m&&p){let e=m[p].weatherData;if(e.length>0){let a=[Array(52).fill(0),Array(52).fill(0),Array(52).fill(0)],t=Array(52).fill(0),s=e.map(e=>e.datetime),l=e.map(e=>e.precip),r=e.map(e=>e.humidity),i=e.map(e=>e.dew);s.forEach((e,s)=>{let n=Math.min(51,Math.floor(s/7));a[0][n]+=l[s],a[1][n]+=r[s],a[2][n]+=i[s],t[n]+=1}),a.forEach((e,s)=>{a[s]=e.map((e,a)=>t[a]>0?e/t[a]:0)});let n=Array.from({length:52},(e,a)=>a+1),c=n.map(e=>G(e));N({precip:a[0],humidity:a[1],dew:a[2],xValues:n,xNames:c})}}},[p,m]),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"".concat(d().className," text-accent-dark text-2xl pb-2"),children:"Climate"}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Precipitation, Humidity & Dew"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%]",children:(0,s.jsx)("div",{className:"mt-8 p-4 mx-4",children:(0,s.jsx)("div",{className:"".concat(n().className," mb-4"),children:"Summary"})})}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row justify-center items-center",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center text-center",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-8"),children:"Daily Average For Each Week of"}),f&&(0,s.jsx)("div",{className:"w-56",children:(0,s.jsx)(F.ZP,{value:null!=p?p:f[0],onChange:(e,a)=>b(a),min:Math.min(...f),max:Math.max(...f),step:1,marks:f.map(e=>({value:e,label:e===Math.min(...f)||e===Math.max(...f)||e===p?e.toString():""})),valueLabelDisplay:"auto"})})]}),(0,s.jsx)("div",{className:"",children:g&&(0,s.jsx)(A,{data:[{z:[g.precip],x:g.xNames,y:[0],type:"heatmap",colorscale:"Blues",colorbar:{len:.3,y:.15},showscale:!0},{z:[g.humidity],x:g.xNames,y:[1],type:"heatmap",colorscale:"Greens",colorbar:{len:.3,y:.5},showscale:!0},{z:[g.dew],x:g.xNames,y:[2],type:"heatmap",colorscale:"Purples",colorbar:{len:.3,y:.85},showscale:!0}],layout:{xaxis:{title:"Week of Year",tickvals:g.xNames.filter((e,a)=>a%4==0)},yaxis:{title:"",tickvals:[0,1,2],ticktext:["Precipitation (mm)","Humidity (%)","Dew (\xb0C)"]},margin:{t:10,b:100,l:120,r:0}},style:{width:"100%",height:"100%"}})})]})})]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Temperature Suitability"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%]",children:(0,s.jsxs)("div",{className:"mt-8 p-4 mx-4",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4"),children:"End of Completed Season Averages"}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Corn Heat Units (CHUs):"}),(0,s.jsx)("div",{children:"".concat(C," \xb1 ").concat(Y)})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{children:"Growind Degree Days (GDDs)"}),(0,s.jsx)("div",{children:"Base Temp. 0\xb0C"})]}),(0,s.jsx)("div",{children:"".concat(L," \xb1 ").concat(_)})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{children:"Growind Degree Days (GDDs)"}),(0,s.jsx)("div",{children:"Base Temp. 5\xb0C"})]}),(0,s.jsx)("div",{children:"".concat(I," \xb1 ").concat(H)})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{children:"Growind Degree Days (GDDs)"}),(0,s.jsx)("div",{children:"Base Temp. 10\xb0C"})]}),(0,s.jsx)("div",{children:"".concat(z," \xb1 ").concat(V)})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{children:"Growind Degree Days (GDDs)"}),(0,s.jsx)("div",{children:"Base Temp. 15\xb0C"})]}),(0,s.jsx)("div",{children:"".concat(q," \xb1 ").concat(Q)})]})]})}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row justify-center items-center",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center text-center",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-8"),children:"Year:"}),f&&(0,s.jsx)("div",{className:"w-56",children:(0,s.jsx)(F.ZP,{value:null!=y?y:f[0],onChange:(e,a)=>w(a),min:Math.min(...f),max:Math.max(...f),step:1,marks:f.map(e=>({value:e,label:e===Math.min(...f)||e===Math.max(...f)||e===y?e.toString():""})),valueLabelDisplay:"auto"})})]}),(0,s.jsx)("div",{className:"",children:M&&(0,s.jsx)(A,{data:M,layout:{xaxis:{title:"Date"},yaxis:{title:"Cumulative Heat Units"},margin:{t:20,b:40,l:60,r:20},legend:{x:.02,y:.98,xanchor:"left",yanchor:"top",orientation:"v",bgcolor:"rgba(255, 255, 255, 0.5)"}},style:{width:"100%",height:"100%"}})})]})})]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Growing Season Length"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%]",children:(0,s.jsxs)("div",{className:"mt-8 mx-4",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4"),children:"Summary"}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Earliest First Frost Date:"}),(0,s.jsx)("div",{children:ea})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Latest First Frost Date:"}),(0,s.jsx)("div",{children:es})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Earliest Last Frost Date:"}),(0,s.jsx)("div",{children:er})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Lastest Last Frost Date:"}),(0,s.jsx)("div",{children:en})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Shortest Growing Season:"}),(0,s.jsx)("div",{children:ed})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Longest Growing Season:"}),(0,s.jsx)("div",{children:em})]})]})}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{className:"".concat(n().className," w-full text-center"),children:"Completed Growing Seasons"}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(A,{data:[{x:X.map(e=>e.year),y:X.map(e=>e.start),type:"bar",orientation:"v",marker:{color:"rgba(0,0,0,0)"},showlegend:!1,hoverinfo:"skip"},{x:X.map(e=>e.year),y:X.map(e=>e.length),type:"bar",orientation:"v",hoverinfo:"text",text:X.map(e=>"Year: ".concat(e.year,"<br>Growing Season Length: ").concat(e.length," days<br>Last Frost Date: ").concat(e.lastFrost,"<br>First Frost Date: ").concat(e.firstFrost)),textposition:"none",marker:{color:"green"},showlegend:!1}],layout:{barmode:"stack",xaxis:{title:"Year",zeroline:!1,tickvals:X.map(e=>e.year),range:[Math.min(...X.map(e=>e.year))-.8,Math.max(...X.map(e=>e.year))+.8]},yaxis:{title:"Date",tickvals:Array.from({length:Math.round(12.166666666666666)},(e,a)=>30*a),ticktext:Array.from({length:Math.round(12.166666666666666)},(e,a)=>k(30*a)),range:[0,365]},margin:{t:0,b:40,l:100,r:0}},style:{width:"100%",height:"100%"}})})]})})]})]})]})};function T(e){let{legend:a}=e;return(0,s.jsxs)("div",{className:"",children:[(0,s.jsx)("div",{className:"".concat(d().className," text-center mb-2 font-medium"),children:"Legend"}),Object.keys(a).map(e=>(0,s.jsxs)("div",{className:"legend-item flex items-center mb-1",children:[(0,s.jsx)("span",{className:"legend-color block w-4 h-4 mr-2",style:{backgroundColor:a[e]}}),(0,s.jsx)("span",{className:"legend-label",children:e})]},e))]})}var L=t(3223),U=e=>{let{windDirection:a,windDirectionStdDev:t}=e,l=Math.round(a),r=Math.round(t);return(0,s.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute",children:(0,s.jsx)(L.Z,{className:"text-blue-600 h-40 w-40 pb-20",style:{transform:"rotate(".concat(l,"deg)")}})}),(0,s.jsx)("div",{className:"absolute",children:(0,s.jsx)(L.Z,{className:"text-blue-400 h-20 w-20 pb-10",style:{transform:"rotate(".concat(l+r,"deg)")}})}),(0,s.jsx)("div",{className:"absolute",children:(0,s.jsx)(L.Z,{className:"text-blue-400 h-20 w-20 pb-10",style:{transform:"rotate(".concat(l-r,"deg)")}})})]})};function _(e,a,t,s,l,r){let i=document.createElement("canvas");i.width=a,i.height=t;let n=i.getContext("2d");if(!n)throw Error("Failed to get canvas 2D context");let c=n.createImageData(a,t);if(e.forEach((e,a)=>{if(e===s||null===e)c.data[4*a+3]=0;else{let t=l(e).rgb();c.data[4*a]=t[0],c.data[4*a+1]=t[1],c.data[4*a+2]=t[2],c.data[4*a+3]=255}}),1===r)return i.toDataURL();n.putImageData(c,0,0);let d=document.createElement("canvas");d.width=a*r,d.height=t*r;let o=d.getContext("2d");if(!o)throw Error("Failed to get scaled canvas 2D context");return o.imageSmoothingEnabled=!1,o.drawImage(i,0,0,d.width,d.height),d.toDataURL()}let B=(0,x.default)(()=>Promise.all([t.e(733),t.e(212),t.e(969)]).then(t.bind(t,1969)),{loadableGenerated:{webpack:()=>[1969]},ssr:!1});var I=e=>{var a;let{lat:t,lng:l,rasterDataCache:r,elevationData:i,cropHeatMaps:c,yearlyYields:m,climateData:h,score:x,setScore:u}=e,[v,j]=(0,o.useState)([]),[b,w]=(0,o.useState)(null),[M,E]=(0,o.useState)(null),[C,k]=(0,o.useState)(null),[P,O]=(0,o.useState)(null),[G,A]=(0,o.useState)(null),[Y,L]=(0,o.useState)("Elevation"),[I,W]=(0,o.useState)(null),[H,R]=(0,o.useState)(null),[z,Z]=(0,o.useState)(null),[V,J]=(0,o.useState)(""),[q,K]=(0,o.useState)(null);return(0,o.useEffect)(()=>{if(r){let e=Object.keys(r).map(Number);j(e),null===b&&w(e[0]);let a=Object.keys(r).length,{totalUsableLandPct:t,totalArea:s}=Object.values(r).reduce((e,a)=>(a.usableLandPct&&(e.totalUsableLandPct+=a.usableLandPct,e.totalArea+=a.area),e),{totalUsableLandPct:0,totalArea:0});A(t/a),O(s/a*900)}},[r]),(0,o.useEffect)(()=>{if(i&&Y)switch(Y){case"Elevation":W({imageUrl:i.elevationUrl,min:i.minElevation,max:i.maxElevation});break;case"Slope":W({imageUrl:i.slopeUrl,min:i.minSlope,max:i.maxSlope});break;case"Convexity":W({imageUrl:i.convexityUrl,min:i.minConvexity,max:i.maxConvexity})}},[i,Y]),(0,o.useEffect)(()=>{if(h)for(let a of Object.keys(h).map(e=>Number(e)).sort((e,a)=>a-e)){var e;let t=null===(e=h[a])||void 0===e?void 0:e.weatherData;if(t&&t.length>=365){R({dir:t.map(e=>e.winddir),speed:t.map(e=>e.windspeed),gust:t.map(e=>e.windgust)});break}}},[h]),(0,o.useEffect)(()=>{(async()=>{if(H&&i){let{aspect:e,slope:a}=i,t=(e,a,t,s)=>a*Math.cos(Math.PI/180*Math.abs(e-t))*s,s=[],l=[],r=0,n=0,c=0,d=0;a.forEach((a,i)=>{let o=e[i];if(a&&o){let e=180/Math.PI*Math.atan(a)/90,i=S(H.dir.map((a,s)=>t(o,e,a,H.speed[s]))),m=S(H.dir.map((a,s)=>t(o,e,a,H.gust[s])));s.push(i),l.push(m),r=Math.min(r,i),n=Math.max(n,i),c=Math.min(c,m),d=Math.max(d,m)}else s.push(null),l.push(null)});let o=S(H.dir),m=D(H.dir),h=S(H.speed),x=D(H.speed),u=S(H.gust),v=D(H.gust),f=g().scale(["blue","green","yellow","brown"]).domain([r,n]),j=await _(s,i.width-2,i.height-2,null,f,15),p=g().scale(["blue","green","yellow","brown"]).domain([c,d]);Z({windSpeedExposureUrl:j,windGustExposureUrl:await _(l,i.width-2,i.height-2,null,p,15),avgWindDir:o,stdWindDir:m,avgWindSpeed:h,stdWindSpeed:x,avgWindGust:u,stdWindGust:v,minSpeedExposure:r,maxSpeedExposure:n,minGustExposure:c,maxGustExposure:d,bbox:i.bbox}),J("Speed")}})()},[H,i]),(0,o.useEffect)(()=>{if(console.log("Wind Exposure:",z),V&&z)switch(V){case"Speed":K({imageUrl:z.windSpeedExposureUrl,min:z.minSpeedExposure,max:z.maxSpeedExposure});break;case"Gust":K({imageUrl:z.windGustExposureUrl,min:z.minGustExposure,max:z.maxGustExposure})}},[V,z]),(0,o.useEffect)(()=>{null!==b&&r&&E(r[b])},[b,r]),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"".concat(d().className," text-accent-dark text-2xl pb-2"),children:"Topography"}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg"),children:"Size & Layout"}),M?(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-[40%] mt-8 p-4",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Summary"}),(0,s.jsx)(y,{headers:["Land Section","% of Land","Area (m\xb2)","Area (ac)"],data:[{a:"Total Property",p:"100",a1:"".concat(null!==(a=null==P?void 0:P.toFixed(2))&&void 0!==a?a:""),a2:"".concat(((null!=P?P:0)/4046.8565).toFixed(2))},{a:"Historical Cropland",p:"".concat(((null!=G?G:0)*100).toFixed(2)),a1:"".concat(((null!=P?P:0)*(null!=G?G:0)).toFixed(2)),a2:"".concat(((null!=P?P:0)/4046.8565*(null!=G?G:0)).toFixed(2))},{a:"Other",p:"".concat(((1-(null!=G?G:0))*100).toFixed(2)),a1:"".concat(((null!=P?P:0)*(1-(null!=G?G:0))).toFixed(2)),a2:"".concat(((null!=P?P:0)/4046.8565*(1-(null!=G?G:0))).toFixed(2))}]})]}),(0,s.jsx)("div",{className:"w-[60%] flex-row",children:(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"flex-row w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center h-16",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-8"),children:"Year:"}),(0,s.jsx)("div",{className:"w-56",children:(0,s.jsx)(F.ZP,{value:null!=b?b:v[0],onChange:(e,a)=>w(a),min:Math.min(...v),max:Math.max(...v),step:1,marks:v.map(e=>({value:e,label:e===Math.min(...v)||e===Math.max(...v)||e===b?e.toString():""})),valueLabelDisplay:"auto"})})]}),(0,s.jsx)(B,{latitude:t,longitude:l,zoom:15,bbox:M.bbox,imageUrl:M.imageUrl})]}),(0,s.jsx)("div",{className:"ml-2 mt-8",children:(0,s.jsx)(T,{legend:M.legend})})]})})]}):(0,s.jsx)(p,{})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg"),children:"Elevation"}),i&&I?(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-[40%] p-4 mt-8",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Summary"}),(0,s.jsx)(y,{headers:["Elevation View","Average"],data:[{view:"Elevation",avg:"".concat(i.avgElevation.toFixed(2)," \xb1 ").concat(i.stdElevation.toFixed(2))},{view:"Slope",avg:"".concat(i.avgSlope.toFixed(5)," \xb1 ").concat(i.stdSlope.toFixed(5))},{view:"Convexity",avg:"".concat(i.avgConvexity.toFixed(5)," \xb1 ").concat(i.stdConvexity.toFixed(5))}]})]}),(0,s.jsx)("div",{className:"w-[60%] flex-row",children:(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center h-16",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-4"),children:"Elevation View:"}),(0,s.jsx)(f,{options:["Elevation","Slope","Convexity"],selected:Y,onSelect:e=>L(e)})]}),(0,s.jsx)(B,{latitude:t,longitude:l,zoom:15,bbox:i.bbox,imageUrl:I.imageUrl})]}),(0,s.jsxs)("div",{className:"flex-row ml-2 justify-start items-center mt-16",children:[(0,s.jsx)("div",{className:"".concat(d().className," mb-2 text-center"),children:Y}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(N,{vmin:I.min,vmax:I.max,numIntervals:5,heatmapColors:["blue","green","yellow","brown"]})})]})]})})]}):(0,s.jsx)(p,{})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg"),children:"Wind Exposure"}),z&&q?(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-[40%] p-4 mt-8",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Summary"}),(0,s.jsx)(y,{headers:["Exposure Type","Average"],data:[{type:"Wind Speed",avg:"".concat(z.avgWindSpeed.toFixed(2)," \xb1 ").concat(z.stdWindSpeed.toFixed(2))},{type:"Wind Gust",avg:"".concat(z.avgWindGust.toFixed(2)," \xb1 ").concat(z.stdWindGust.toFixed(2))}]}),(0,s.jsxs)("div",{className:"flex-row justify-center mx-4",children:[(0,s.jsx)("div",{className:"w-full mb-20",children:"Average Wind Direction (and Standard Deviation):"}),z.avgWindDir&&z.stdWindDir&&(0,s.jsx)("div",{className:"h-20",children:(0,s.jsx)(U,{windDirection:z.avgWindDir,windDirectionStdDev:z.stdWindDir})})]})]}),(0,s.jsx)("div",{className:"w-[60%] flex-row",children:(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center h-16",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-4"),children:"Wind Exposure Type:"}),(0,s.jsx)(f,{options:["Speed","Gust"],selected:V,onSelect:e=>J(e)})]}),(0,s.jsx)(B,{latitude:t,longitude:l,zoom:15,bbox:z.bbox,imageUrl:q.imageUrl})]}),(0,s.jsxs)("div",{className:"flex-row ml-2 justify-start items-center mt-16",children:[(0,s.jsx)("div",{className:"".concat(d().className," mb-2 text-center"),children:"Exposure"}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(N,{vmin:q.min,vmax:q.max,numIntervals:5,heatmapColors:["blue","green","yellow","brown"]})})]})]})})]}):(0,s.jsx)(p,{})]})]})};let W={0:"Cloud",10:"Cloud",20:"Water",30:"Barren",34:"Developed",35:"Greenhouses",50:"Shrubland",80:"Wetland",85:"Peatland",110:"Grassland",120:"Agriculture",122:"Flaxseed",130:"Too Wet",131:"Fallow",132:"Cereals",133:"Barley",134:"Mustard",135:"Millet",136:"Oats",137:"Rye",138:"Spelt",139:"Triticale",140:"Wheat",141:"Switchgrass",142:"Sorghum",143:"Quinoa",145:"Winter Wheat",146:"Spring Wheat",147:"Corn",148:"Tobacco",149:"Ginseng",150:"Oilseeds",151:"Borage",152:"Camelina",153:"Canola",154:"Flaxseed2",155:"Mustard",156:"Safflower",157:"Sunflower",158:"Soybeans",160:"Pulses",161:"Other Pulses",162:"Peas",163:"Chickpeas",167:"Beans",168:"Fababeans",174:"Lentils",175:"Vegetables",176:"Tomatoes",177:"Potatoes",178:"Sugarbeets",179:"Other Veg",180:"Fruits",181:"Berries",182:"Blueberry",183:"Cranberry",185:"Other Berry",188:"Orchards",189:"Other Fruits",190:"Vineyards",191:"Hops",192:"Sod",193:"Herbs",194:"Nursery",195:"Buckwheat",196:"Canaryseed",197:"Hemp",198:"Vetch",199:"Other Crops",200:"Forest",210:"Coniferous",220:"Broadleaf",230:"Mixedwood"};var H=t(2169);let R=e=>{let[a,t]=(0,o.useState)({}),[s,l]=(0,o.useState)(null);return(0,o.useEffect)(()=>{let a=async()=>{try{let{image:a}=await Z("".concat(e,"/demo/raster_data/elevation.tif")),t=await q(a);l(t)}catch(e){console.error("Error fetching raster data:",e)}};(async()=>{let a={};try{for(let t of[2014,2015,2016,2017,2018,2019,2020,2021]){let s="".concat(e,"/demo/raster_data/").concat(t,".tif"),{image:l}=await Z(s),r=await V(l);a[t]=r}t(e=>({...e,...a}))}catch(e){console.error("Error fetching raster data:",e)}})(),a()},[e]),{rasterDataCache:a,elevationData:s}},z=g().scale("Set1").colors(Object.keys(W).length),Z=async e=>{let a=await fetch(e);if(!a.ok)throw Error("Failed to fetch ".concat(e));let t=await a.arrayBuffer(),s=await (0,H.go)(t);return{image:await s.getImage()}},V=async e=>{let a=Array.from((await e.readRasters())[0]),t={};a.forEach(e=>{t[e]=(t[e]||0)+1});let s=.02*a.length;a.forEach((e,l)=>{t[e]<s&&(a[l]=0)});let l=0,r=0,i=[];Object.keys(t).forEach(e=>{let a=parseInt(e),n=W[a];if(w.includes(n)){let e=t[a];r+=e,!i.includes(n)&&e>=s&&i.push(n)}0!=a&&(l+=t[a])});let n=r/l,c=l,d=e.getWidth(),o=e.getHeight(),m=await J(a,d,o),h=new Set(a),x={};return h.forEach(e=>{let a=W[e];if(a&&"Cloud"!==a){let t=Object.keys(W).findIndex(a=>parseInt(a)===e);x[a]=z[t]}}),{imageUrl:m,legend:x,bbox:e.getBoundingBox(),usableLandPct:n,area:c,majorCommodityCropsGrown:i}},J=(e,a,t)=>{let s=document.createElement("canvas");s.width=a,s.height=t;let l=s.getContext("2d");if(!l)throw Error("Failed to get canvas 2D context");l.imageSmoothingEnabled=!1;let r=l.createImageData(a,t);for(let a=0;a<e.length;a++){let t=e[a],s=Object.keys(W).findIndex(e=>parseInt(e)===t),[l,i,n]=(-1!==s?g()(z[s]):g()("black")).rgb();r.data[4*a]=l,r.data[4*a+1]=i,r.data[4*a+2]=n,r.data[4*a+3]=0===t||10===t?0:255}l.putImageData(r,0,0);let i=document.createElement("canvas");i.width=10*a,i.height=10*t;let n=i.getContext("2d");if(!n)throw Error("Failed to get scaled canvas 2D context");return n.imageSmoothingEnabled=!1,n.drawImage(s,0,0,i.width,i.height),i.toDataURL()},q=async e=>{let a=Array.from((await e.readRasters())[0]),t=e.getWidth(),s=e.getHeight(),l=a.filter(e=>!isNaN(e)&&null!==e&&0!==e),r=Math.min(...l),i=Math.max(...l),n=S(l),c=D(l),d=g().scale(["blue","green","yellow","brown"]).domain([r,i]),o=await _(a,t,s,0,d,10),{slope:m,minSlope:h,maxSlope:x,avgSlope:u,stdSlope:v,aspect:f}=function(e,a,t){let s=[],l=[],r=1e6,i=0;function n(t,s){var l;return null!==(l=e[t*a+s])&&void 0!==l?l:NaN}for(let e=1;e<t-1;e++)for(let t=1;t<a-1;t++){let a=n(e,t),c=n(e,t-1),d=n(e,t+1),o=n(e-1,t),m=n(e+1,t);if([a,c,d,o,m].some(e=>0===e)){s.push(null),l.push(null);continue}let h=(d-c)/60,x=(m-o)/60,u=Math.sqrt(Math.pow(h,2)+Math.pow(x,2)),v=180/Math.PI*Math.atan2(x,h),f=v>=0?v:v+360;isNaN(u)?(console.warn("Invalid slope value at",{i:e,j:t,overallSlope:u}),s.push(null),l.push(null)):(u<r&&(r=u),u>i&&(i=u),s.push(u),l.push(f))}let c=S(s),d=D(s);return{slope:s,minSlope:r,maxSlope:i,avgSlope:c,stdSlope:d,aspect:l}}(a,t,s),j=g().scale(["blue","green","yellow","brown"]).domain([h,x]),p=await _(m,t-2,s-2,null,j,10),{convexity:b,minConvexity:N,maxConvexity:y,avgConvexity:w,stdConvexity:M}=function(e,a,t){let s=[],l=1e6,r=0;function i(t,s){var l;return null!==(l=e[t*a+s])&&void 0!==l?l:NaN}for(let e=1;e<t-1;e++)for(let t=1;t<a-1;t++){let a=i(e,t),n=i(e,t-1),c=i(e,t+1),d=i(e-1,t),o=i(e+1,t);if([a,n,c,d,o].some(e=>0===e)){s.push(null);continue}let m=(c-2*a+n)/900+(o-2*a+d)/900;m<l&&(l=m),m>r&&(r=m),s.push(m)}let n=S(s),c=D(s);return{convexity:s,minConvexity:l,maxConvexity:r,avgConvexity:n,stdConvexity:c}}(a,t,s),E=g().scale(["blue","green","yellow","brown"]).domain([N,y]),C=await _(b,t-2,s-2,null,E,10);return{bbox:e.getBoundingBox(),slope:m,aspect:f,width:t,height:s,elevationUrl:o,avgElevation:n,stdElevation:c,minElevation:r,maxElevation:i,slopeUrl:p,avgSlope:u,stdSlope:v,minSlope:h,maxSlope:x,convexityUrl:C,avgConvexity:w,stdConvexity:M,minConvexity:N,maxConvexity:y}},K={Flaxseed:{vmin:56,vmax:96},Wheat:{vmin:77,vmax:117},Barley:{vmin:61,vmax:101},Oats:{vmin:56,vmax:96},Canola:{vmin:43,vmax:83},Peas:{vmin:66,vmax:106},Corn:{vmin:63,vmax:103},Soy:{vmin:63,vmax:103}},Q=e=>{let[a,t]=(0,o.useState)({});return(0,o.useEffect)(()=>{Promise.all(w.map(a=>new Promise((s,l)=>{let r=new Image;r.src="".concat(e,"/demo/crop_heat_maps/").concat(a,".png"),r.onload=()=>{let e=document.createElement("canvas"),l=e.getContext("2d");if(!l)throw Error("Failed to get canvas 2D context");e.width=r.width,e.height=r.height,l.drawImage(r,0,0);let i=l.getImageData(0,0,e.width,e.height),n=i.data;setTimeout(()=>{let{min:c,max:d,average:o,stdDev:m,range:h,thresholdMin:x,thresholdMax:u}=$(n,a);l.putImageData(i,0,0);let v=document.createElement("canvas");v.width=10*r.width,v.height=10*r.height;let f=v.getContext("2d");if(!f)throw Error("Failed to get scaled canvas 2D context");f.imageSmoothingEnabled=!1,f.drawImage(e,0,0,v.width,v.height);let j=v.toDataURL();t(e=>({...e,[a]:{imageUrl:j,min:c,max:d,average:o,stdDev:m,range:h,thresholdMin:x,thresholdMax:u}})),s()},0)},r.onerror=()=>{console.error("Failed to load image for ".concat(a)),l()}}))).catch(e=>console.error("Error preloading and processing images:",e))},[e]),a},$=(e,a)=>{let t=g().scale(["black","red","yellow","white"]).correctLightness().domain([0,1]),s=[],{vmin:l,vmax:r}=K[a],i=r-l;for(let a=0;a<e.length;a+=4){let r=(e[a]+e[a+1]+e[a+2])/3/255;s.push(r*i+l);let n=t(r).rgb();e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2]}let n=Math.min(...s),c=Math.max(...s),d=S(s),o=D(s);return(isNaN(n)||isNaN(c)||isNaN(d)||isNaN(o))&&console.error("processData is returning NaN values"),{min:n,max:c,average:d,stdDev:o,range:i,thresholdMin:l,thresholdMax:r}};var X=t(8355),ee=t.n(X);let ea=e=>{let[a,t]=(0,o.useState)([]);return(0,o.useEffect)(()=>{(async()=>{let a=await fetch("".concat(e,"/demo/yearly_crop_yields.csv")),s=await a.text();t(ee().parse(s,{header:!0,dynamicTyping:!0}).data)})()},[]),a},et=e=>{let[a,t]=(0,o.useState)({}),[s,l]=(0,o.useState)(!0);(0,o.useEffect)(()=>{ee().parse("".concat(e,"/demo/weather.csv"),{download:!0,header:!0,dynamicTyping:!0,complete:e=>{r(e.data.map(e=>({datetime:e.datetime,tempmin:parseFloat(e.tempmin),tempmax:parseFloat(e.tempmax),temp:parseFloat(e.temp),precip:parseFloat(e.precip),humidity:parseFloat(e.humidity),dew:parseFloat(e.dew),windgust:parseFloat(e.windgust),windspeed:parseFloat(e.windspeed),winddir:parseFloat(e.winddir)}))),l(!1)}})},[]);let r=e=>{let a={},s=e.reduce((e,a)=>{if(a.datetime){let t=parseInt(a.datetime.substring(0,4));e[t]||(e[t]=[]),e[t].push(a)}return e},{});Object.keys(s).forEach(e=>{let t=parseInt(e),{firstFrost:l,lastFrost:r,growingSeasonLength:d}=i(s[t]);a[t]={weatherData:s[t],firstFrost:l,lastFrost:r,growingSeasonLength:d,cornHeatUnits:n(s[t]),GDD0:c(s[t],0),GDD5:c(s[t],5),GDD10:c(s[t],10),GDD15:c(s[t],15)}}),t(a)},i=e=>{var a,t;let s=e.filter(e=>e.tempmin<=0),l=new Date("".concat(e[0].datetime.substring(0,4),"-07-01")),r=s.filter(e=>new Date(e.datetime)<l),i=s.filter(e=>new Date(e.datetime)>l),n=(null===(a=r.reduce((e,a)=>Math.abs(new Date(a.datetime).getTime()-l.getTime())<Math.abs(new Date(e.datetime).getTime()-l.getTime())?a:e,r[0]))||void 0===a?void 0:a.datetime)||null,c=(null===(t=i.reduce((e,a)=>Math.abs(new Date(a.datetime).getTime()-l.getTime())<Math.abs(new Date(e.datetime).getTime()-l.getTime())?a:e,i[0]))||void 0===t?void 0:t.datetime)||null,d=null;if(c&&n){let e=new Date(c),a=new Date(n);d=Math.ceil((e.getTime()-a.getTime())/864e5)}return{firstFrost:c,lastFrost:n,growingSeasonLength:d}},n=e=>{let a={},t=0;return e.forEach(e=>{let s=Math.min(e.tempmax,30),l=(1.8*(e.tempmin-4.4)+3.33*(s-10)-.084*Math.pow(s-10,2))/2;t+=Math.max(0,l),a[e.datetime]=t,e.tempmin<4.4||(t+=Math.max(0,l)),a[e.datetime]=t}),a},c=(e,a)=>{let t={},s=0;return e.forEach(e=>{let l=(e.tempmax+e.tempmin)/2;s+=Math.max(0,l-a),t[e.datetime]=s}),t};return a},es={street_number:"8159",route:"Side Road 30",locality:"Rockwood",administrative_area_level_3:"Centre Wellington",administrative_area_level_2:"Wellington County",administrative_area_level_1:"ON",country:"CA",postal_code:"N0B 2K0"};function el(){let e="43.6929954",a="-80.3071343",[t,l]=(0,o.useState)(null),[i,c]=(0,o.useState)(null),[x,u]=(0,o.useState)(null),[f,j]=(0,o.useState)("EstimatedYield"),{rasterDataCache:p,elevationData:b}=R(""),g=Q(""),N=ea(""),y=et("");return(0,s.jsx)("div",{className:"".concat(r().className," bg-accent-light text-black"),children:(0,s.jsx)("div",{className:"relative m-4",children:(0,s.jsxs)(m,{className:"mb-4",children:[(0,s.jsxs)("section",{id:"summary",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-accent text-2xl mb-2 w-full text-center"),children:"THIS IS A DEMO REPORT!"}),(0,s.jsx)("div",{className:"".concat(d().className," text-accent-dark text-3xl pb-2"),children:"Summary"}),(0,s.jsxs)("div",{className:"w-full sm:flex flex-row",children:[(0,s.jsxs)("div",{className:"w-[44%] p-4 mx-12",children:[(0,s.jsx)("div",{className:"".concat(n().className," flex justify-between mb-2 text-2xl"),children:"Property"}),(0,s.jsx)(h,{addressComponents:es,latitude:e,longitude:a})]}),(0,s.jsx)("div",{className:"w-[56%] p-4",children:(0,s.jsx)(v,{})})]})]}),(0,s.jsx)("div",{className:"flex justify-center space-x-8 border-b border-accent-dark mb-4 mt-10",children:["EstimatedYield","Climate","Topography"].map(e=>(0,s.jsx)("button",{onClick:()=>j(e),className:"py-2 px-4 w-48 rounded-t-lg ".concat(f===e?"bg-accent-dark text-white":"text-black"," hover:bg-accent-dark hover:opacity-75 hover:text-white"),children:e.replace(/([A-Z])/g," $1")},e))}),(0,s.jsx)("div",{children:(()=>{switch(f){case"EstimatedYield":return(0,s.jsx)(C,{lat:e,lng:a,rasterDataCache:p,elevationData:b,cropHeatMaps:g,yearlyYields:N,climateData:y,score:t,setScore:l});case"Climate":return(0,s.jsx)(Y,{lat:e,lng:a,rasterDataCache:p,elevationData:b,cropHeatMaps:g,yearlyYields:N,climateData:y,score:i,setScore:c});case"Topography":return(0,s.jsx)(I,{lat:e,lng:a,rasterDataCache:p,elevationData:b,cropHeatMaps:g,yearlyYields:N,climateData:y,score:x,setScore:u});default:return null}})()})]})})})}}},function(e){e.O(0,[639,340,971,23,744],function(){return e(e.s=7225)}),_N_E=e.O()}]);