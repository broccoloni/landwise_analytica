(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7225:function(e,a,t){Promise.resolve().then(t.bind(t,2007))},2007:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return eo}});var s=t(7437),l=t(8022),r=t.n(l),i=t(9436),n=t.n(i),c=t(8693),d=t.n(c),o=t(2265),m=e=>{let{children:a,className:t}=e;return(0,s.jsx)("div",{className:"bg-white ".concat(t," rounded-lg border p-8"),children:a})},h=e=>{let{addressComponents:a,latitude:t,longitude:l}=e;return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Address:"}),(0,s.jsxs)("p",{children:[a.street_number," ",a.route]})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Locality:"}),(0,s.jsx)("p",{children:a.locality})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Postal Code:"}),(0,s.jsx)("p",{children:a.postal_code})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"State / Province:"}),(0,s.jsx)("p",{children:a.administrative_area_level_1})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"County:"}),(0,s.jsx)("p",{children:a.administrative_area_level_2})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Country:"}),(0,s.jsx)("p",{children:a.country})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Longitude:"}),(0,s.jsx)("p",{children:l})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("p",{className:"mr-4",children:"Latitude:"}),(0,s.jsx)("p",{children:t})]})]})},x=t(7818);let u=(0,x.default)(()=>Promise.all([t.e(934),t.e(8)]).then(t.bind(t,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});var v=()=>{let e=["Estimated Yield","Climate","Topography"],a=[96,92,86],t=a.reduce((e,a)=>e+a,0)/a.length,l=[...a,a[0]],i=[...e,e[0]];return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-2xl"),children:"Score: ".concat(Math.round(t),"%")}),(0,s.jsx)("div",{className:"",style:{height:"300px"},children:(0,s.jsx)(u,{data:[{type:"scatterpolar",r:l,theta:i,fill:"toself",marker:{color:"var(--accent)"},line:{shape:"spline",smoothing:.8,color:"var(--accent)",width:3},fillcolor:"rgba(0,0,0, 0.1)",hoverinfo:"none"}],layout:{polar:{radialaxis:{visible:!0,range:[0,100],tickfont:{size:14,color:"#333",family:r().style.fontFamily},gridcolor:"#ccc"},angularaxis:{tickfont:{size:14,color:"#444",family:r().style.fontFamily},linecolor:"#888"}},margin:{t:20,l:160,r:120,b:20},showlegend:!1,paper_bgcolor:"#fff",plot_bgcolor:"#f5f5f5",dragmode:!1},useResizeHandler:!0,style:{width:"100%",height:"100%"}})})]})},f=e=>{let{options:a,selected:t,onSelect:l,className:r}=e,[i,n]=(0,o.useState)(!1),c=(0,o.useRef)(null);return(0,o.useEffect)(()=>{let e=e=>{c.current&&!c.current.contains(e.target)&&n(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.jsxs)("div",{className:"relative inline-block z-10 ".concat(r),ref:c,children:[(0,s.jsxs)("button",{onClick:()=>n(!i),className:"flex items-center p-2 bg-gray-200 text-black rounded focus:outline-none",children:[t,(0,s.jsx)("span",{className:"flex justify-center items-center ml-2 pl-2",children:(0,s.jsx)("span",{className:"w-0 h-0 border-l-4 border-l-transparent border-t-4 border-t-black border-r-4 border-r-transparent"})})]}),i&&(0,s.jsx)("ul",{className:"absolute z-10 min-w-24 bg-white border border-gray-300 rounded shadow-lg mt-1",children:a.map((e,t)=>(0,s.jsx)("li",{onClick:()=>{l(e),n(!1)},className:"p-2 cursor-pointer hover:bg-accent-medium hover:text-white border-b border-gray-300 ".concat(t===a.length-1?"border-b-0":""),children:e},e))})]})},p=t(3274);function j(){return(0,s.jsx)("div",{className:"flex justify-center h-full w-full my-20",children:(0,s.jsx)(p.Z,{className:"h-20 w-20 animate-spin text-black"})})}var g=t(8579),b=t.n(g),N=e=>{let{vmin:a,vmax:t,numIntervals:l=5,heatmapColors:r}=e,i=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=i.current;if(!e){console.error("Canvas element not found");return}let s=e.getContext("2d");if(!s)throw Error("Failed to get canvas 2D context");let l=b().scale(r).domain([t,a]);for(let r=0;r<e.height;r++){let i=l(a+r/e.height*(t-a)).hex();s.fillStyle=i,s.fillRect(0,r,e.width,1)}},[a,t,r]);let n=((e,a,t)=>{let s=(a-e)/(t-1),l=[];for(let a=0;a<t;a++)l.push(e+a*s);return l})(a,t,l);return(0,s.jsxs)("div",{className:"flex justify-center items-center",children:[(0,s.jsx)("canvas",{ref:i,width:30,height:300,className:"border border-gray-300"}),(0,s.jsx)("div",{className:"flex flex-col justify-between ml-2 h-full",children:n.reverse().map((e,a)=>(0,s.jsx)("span",{children:e>5?e.toFixed(1):e.toFixed(5)},a))})]})},y=e=>{let{headers:a,data:t}=e;return(0,s.jsxs)("table",{className:"min-w-full border-collapse mb-4",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{children:a.map((e,a)=>(0,s.jsx)("th",{className:"".concat(n().className," px-4 py-2 font-normal text-right"),children:e},a))})}),(0,s.jsx)("tbody",{children:t.map((e,a)=>(0,s.jsx)("tr",{children:Object.values(e).map((e,a)=>(0,s.jsx)("td",{className:"px-4 py-2 text-right",children:e},a))},a))})]})};let w=["Flaxseed","Wheat","Barley","Oats","Canola","Peas","Corn","Soy"],S=e=>{let a=e.filter(e=>null!==e);return 0===a.length?0:a.reduce((e,a)=>e+a,0)/a.length},D=e=>{let a=e.filter(e=>null!==e);if(0===a.length)return 0;let t=S(a);return Math.sqrt(a.reduce((e,a)=>e+Math.pow(a-t,2),0)/a.length)},M=(0,x.default)(()=>Promise.all([t.e(934),t.e(8)]).then(t.bind(t,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1}),E=(0,x.default)(()=>Promise.all([t.e(733),t.e(212),t.e(969)]).then(t.bind(t,1969)),{loadableGenerated:{webpack:()=>[1969]},ssr:!1}),F=["black","red","yellow","white"];var C=e=>{let{lat:a,lng:t,rasterDataCache:l,elevationData:r,cropHeatMaps:i,yearlyYields:c,climateData:m,score:h,setScore:x}=e,[u,v]=(0,o.useState)({});(0,o.useEffect)(()=>{let e=Object.values(u).map(Number);3===e.length&&x(Math.round(S(e)))},[u]);let[p,g]=(0,o.useState)({}),[b,C]=(0,o.useState)({}),[k,P]=(0,o.useState)({}),[O,G]=(0,o.useState)("Flaxseed"),[A,Y]=(0,o.useState)({}),[T,B]=(0,o.useState)(""),[U,_]=(0,o.useState)(""),[L,I]=(0,o.useState)("Flaxseed"),[W,H]=(0,o.useState)([]);(0,o.useEffect)(()=>{if(l){let t=Object.keys(l).filter(e=>"elevation"!==e).map(Number);t.length>0&&H(l[t[0]].bbox);let s={};for(let r of t){var e,a;let t=null===(a=l[r])||void 0===a?void 0:null===(e=a.majorCommodityCropsGrown)||void 0===e?void 0:e[0];t&&(s[r]=t)}C(s)}},[l]),(0,o.useEffect)(()=>{if(c&&b){let i={},n=[],d=[],o={},m={},h=Object.keys(b).map(Number);for(let t of Array.from(new Set(c.map(e=>Number(e.Year)).filter(e=>e>=2014&&e<=2034))))for(let s of w){let l=c.find(e=>e.Crop===s&&e.Year===t&&"Property"===e.levels),r=c.find(e=>e.Crop===s&&e.Year===t&&"Neighbourhood"===e.levels),x=c.find(e=>e.Crop===s&&e.Year===t&&"National"===e.levels),u=(null==l?void 0:l.Yield)||0,v=(null==r?void 0:r.Yield)||0,f=(null==x?void 0:x.Yield)||0;var e=0,a=0;v>0&&(e=u/v),f>0&&(a=u/f),h.includes(Number(t))?s===b[Number(t)]&&(n.push(e),d.push(a),i[Number(t)]={label:"".concat(t," - ").concat(s),property:u,neighbourhood:v,national:f}):(s in o||(o[s]=[]),Array.isArray(o[s])&&o[s].push(e),s in m||(m[s]=[]),Array.isArray(m[s])&&m[s].push(a))}g(i);let x=Math.round(100*S(n)),u=Math.round(100*D(n)),f=Math.round(100*S(d)),p=Math.round(100*D(d));P({histNeighbourhoodPerf:"".concat(x," % \xb1 ").concat(u," %"),histNationalPerf:"".concat(f," % \xb1 ").concat(p," %")});let j=Math.min((f+x)/2,100);j>0&&v(e=>e.histScore?e:{...e,histScore:Math.round(j)});let N={};var t="",s=0,l="",r=1e6;w.forEach(e=>{let a=o[e]||[],i=m[e]||[],n=100*S(a),c=100*D(a),d=100*S(i),h=100*D(i),x=(n+d)/2,u="".concat(n.toFixed(0)," % \xb1 ").concat(c.toFixed(0)," %"),v="".concat(d.toFixed(0)," % \xb1 ").concat(h.toFixed(0)," %");N[e]={neighbourhoodPerf:u,nationalPerf:v,avgPerf:x},x>s&&(t=e,s=x),x<r&&(l=e,r=x)}),Y(N),B(t),_(l)}},[c,b]);let R=Object.keys(p).map(e=>p[e].label),z=Object.keys(p).map(e=>p[e].property),V=Object.keys(p).map(e=>p[e].neighbourhood),Z=Object.keys(p).map(e=>p[e].national),J=c.filter(e=>e.Crop===O&&e.Year>=2014&&e.Year<=2034).filter(e=>["Property","Neighbourhood","National"].includes(e.levels)).reduce((e,a)=>{let t=e.findIndex(e=>e.name===a.levels);return -1!==t?(e[t].x.push(a.Year),e[t].y.push(a.Yield)):e.push({x:[a.Year],y:[a.Yield],name:a.levels,mode:"lines"}),e},[]),[q,K]=(0,o.useState)(null);return(0,o.useEffect)(()=>{i&&L&&K(i[L])},[L,i]),(0,o.useEffect)(()=>{if(A){var e;let a=Object.keys(A).sort((e,a)=>A[a].avgPerf-A[e].avgPerf),t=Math.min(null===(e=A[a[0]])||void 0===e?void 0:e.avgPerf,100);t>0&&v(e=>e.futScore?e:{...e,futScore:Math.round(t)})}},[A]),(0,o.useEffect)(()=>{if(i){let e=Object.entries(i).map(e=>{let[a,t]=e,{average:s,stdDev:l}=t;return{cropName:a,ncv:0!==s?Math.max(0,Math.min(1,l/s)):1,average:s,stdDev:l}});if(e.length>0){let a=Math.min((1-e.sort((e,a)=>e.ncv-a.ncv)[0].ncv)*100,100);a>0&&v(e=>e.consScore?e:{...e,consScore:Math.round(a)})}}},[i]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"".concat(d().className," flex text-accent-dark text-2xl pb-2"),children:[(0,s.jsx)("div",{className:"",children:"Estimated Yield"}),h&&(0,s.jsxs)("div",{className:"",children:[" - ",h,"%"]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Estimated Historic Yield"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("div",{className:"w-[40%] mt-8 p-4",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Performance Comparison"}),(0,s.jsxs)("div",{className:"flex justify-between mb-2 mx-4",children:[(0,s.jsx)("div",{className:"",children:"Crops Grown:"}),b&&(0,s.jsx)("div",{children:Object.values(b).filter((e,a,t)=>t.indexOf(e)===a).join(", ")})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2 mx-4",children:[(0,s.jsx)("div",{className:"",children:"Average Yield vs Neighbourhood:"}),(0,s.jsx)("div",{className:"",children:k.histNeighbourhoodPerf})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2 mx-4",children:[(0,s.jsx)("div",{className:"",children:"Average Yield vs National:"}),(0,s.jsx)("div",{className:"",children:k.histNationalPerf})]})]}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row justify-center items-center w-full",children:[(0,s.jsx)("div",{className:"".concat(n().className," w-full text-center"),children:"Estimated Historic Yield"}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(M,{data:[{x:R,y:z,name:"Property",type:"bar",marker:{color:"#708090"}},{x:R,y:V,name:"Neighbourhood",type:"bar",marker:{color:"#8FBC8F"}},{x:R,y:Z,name:"National",type:"bar",marker:{color:"#B0C4DE"}}],layout:{barmode:"group",xaxis:{title:"Year & Crop Grown",tickangle:-45},yaxis:{title:"Yield (Bushels/Acre)"},legend:{title:{text:"Administrative Level"}},margin:{t:0,b:100,l:50,r:0}},useResizeHandler:!0,style:{width:"100%",height:"100%"}})})]})})]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Estimated Projected Yield"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[44%] mt-8 p-4",children:(0,s.jsx)(()=>{if(!A)return null;let e=Object.keys(A).sort((e,a)=>A[a].avgPerf-A[e].avgPerf);e.filter(e=>A[e].avgPerf>100).length;let a=e.map((e,a)=>({rank:a+1,crop:e,neighbourhoodPerf:A[e].neighbourhoodPerf,nationalPerf:A[e].nationalPerf}));return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 ml-4"),children:"Average Relative Future Property Yield"}),(0,s.jsx)(y,{headers:["Rank","Crop","Property Relative to Neighbourhood","Property Relative to National"],data:a})]})},{})}),(0,s.jsx)("div",{className:"w-[56%]",children:(0,s.jsxs)("div",{className:"flex-row justify-center items-center w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-4"),children:"Estimated Projected Yield for:"}),(0,s.jsx)(f,{options:w,selected:O,onSelect:G})]}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(M,{style:{width:"100%",height:"100%"},className:"mt-0",data:J,layout:{xaxis:{title:"Year"},yaxis:{title:"Yield (Bushels/Acre)"},margin:{t:10,b:50,l:50,r:0},shapes:[{type:"line",x0:2024,x1:2024,y0:0,y1:1,xref:"x",yref:"paper",line:{color:"grey",dash:"dash"}}]}})})]})})]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Yield Consistency Across Property"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%] mt-8 p-4",children:(0,s.jsx)(()=>{if(!i)return null;let e=Object.entries(i).map(e=>{let[a,t]=e,{average:s,stdDev:l}=t;return{cropName:a,ncv:0!==s?Math.max(0,Math.min(1,l/s)):1,average:s,stdDev:l}});if(0===e.length)return null;let a=e.sort((e,a)=>e.ncv-a.ncv);return a[0],a[a.length-1],(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Average Yield Across Property (Bushels/Acre)"}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(y,{headers:["Rank","Crop","Average","Variation"],data:a.map((e,a)=>{let{cropName:t,ncv:s,average:l,stdDev:r}=e;return{rank:a+1,cropName:t,average:"".concat(l.toFixed(2)," \xb1 ").concat(r.toFixed(2)),ncv:s.toFixed(3)}})})})]})},{})}),(0,s.jsx)("div",{className:"w-[60%]",children:q&&L&&W?(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center h-16",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-4"),children:"Yield Heatmap for:"}),(0,s.jsx)(f,{options:w,selected:L,onSelect:I})]}),(0,s.jsx)(E,{latitude:a,longitude:t,zoom:15,bbox:W,imageUrl:q.imageUrl})]}),(0,s.jsxs)("div",{className:"flex-row ml-2 justify-start items-center mt-16",children:[(0,s.jsx)("div",{className:"".concat(d().className," text-center"),children:"Yield"}),(0,s.jsx)("div",{className:"mb-2",children:"(Bushels/Acre)"}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(N,{vmin:q.thresholdMin,vmax:q.thresholdMax,numIntervals:5,heatmapColors:F})})]})]}):(0,s.jsx)(j,{})})]})]})]})},k=t(14);let P=e=>{let a=new Date(2024,0,1);return a.setDate(a.getDate()+e),a.toISOString().split("T")[0].slice(5)},O=["Jan.","Feb.","Mar.","Apr.","May","June","July","Aug.","Sep.","Oct.","Nov.","Dec."],G=e=>{let a=new Date(e),t=O[a.getMonth()],s=a.getDate();return"".concat(t," ").concat(s)},A=e=>{if(isNaN(Number(e)))return e;let a=G(P((e-1)*7)),t=G(P(7*e));return"".concat(a," - ").concat(t)};var Y=t(2170),T=t.n(Y);let B=(0,x.default)(()=>Promise.all([t.e(934),t.e(8)]).then(t.bind(t,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});var U=e=>{let{lat:a,lng:t,rasterDataCache:l,elevationData:r,cropHeatMaps:i,yearlyYields:c,climateData:m,score:h,setScore:x}=e,[u,v]=(0,o.useState)({});(0,o.useEffect)(()=>{let e=Object.values(u).map(Number);3===e.length&&x(Math.round(S(e)))},[u]);let[f,p]=(0,o.useState)(null),[j,g]=(0,o.useState)(null),[b,N]=(0,o.useState)(null),[w,M]=(0,o.useState)([13,39]),[E,F]=(0,o.useState)({precip:"",humidity:"",dew:""}),[C,O]=(0,o.useState)(null),[Y,U]=(0,o.useState)(null),[_,L]=(0,o.useState)(null),[I,W]=(0,o.useState)(null),[H,R]=(0,o.useState)(null),[z,V]=(0,o.useState)(null),[Z,J]=(0,o.useState)(null),[q,K]=(0,o.useState)(null),[Q,$]=(0,o.useState)(null),[X,ee]=(0,o.useState)(null),[ea,et]=(0,o.useState)(null),[es,el]=(0,o.useState)(null),[er,ei]=(0,o.useState)([]),[en,ec]=(0,o.useState)(""),[ed,eo]=(0,o.useState)(""),[em,eh]=(0,o.useState)(""),[ex,eu]=(0,o.useState)(""),[ev,ef]=(0,o.useState)(""),[ep,ej]=(0,o.useState)("");(0,o.useEffect)(()=>{if(m){let r=Object.keys(m).map(Number);p(r),null===j&&g(r[0]),null===C&&O(r[0]);var e=[],a=[],t=[],s=[],l=[];r.forEach(r=>{let i=m[r];if(Object.values(i.cornHeatUnits).length>=365){let r=Math.max(...Object.values(i.cornHeatUnits)),n=Math.max(...Object.values(i.GDD0)),c=Math.max(...Object.values(i.GDD5)),d=Math.max(...Object.values(i.GDD10)),o=Math.max(...Object.values(i.GDD15));e.push(r),a.push(n),t.push(c),s.push(d),l.push(o)}}),L(Math.round(S(e))),W(Math.round(D(e))),R(Math.round(S(a))),V(Math.round(D(a))),J(Math.round(S(t))),K(Math.round(D(t))),$(Math.round(S(s))),ee(Math.round(D(s))),et(Math.round(S(l))),el(Math.round(D(l)));let i=e=>{let a=new Date(e.getFullYear(),0,0);return Math.floor((e.getTime()-a.getTime())/864e5)+1},n=r.map(e=>{let a=m[e];if(!(null==a?void 0:a.lastFrost)||!(null==a?void 0:a.firstFrost))return null;let t=new Date(a.lastFrost),s=new Date(a.firstFrost);return{year:e,length:null==a?void 0:a.growingSeasonLength,start:i(t),end:i(s),lastFrost:null==a?void 0:a.lastFrost,firstFrost:null==a?void 0:a.firstFrost}}).filter(e=>null!==e&&null!==e.length);if(ei(n),n.length>0){let e=n.map(e=>e.end),a=n.map(e=>e.start),t=n.map(e=>e.length).filter(e=>null!==e),s=Math.min(...e),l=Math.max(...e);ec(G(P(s))),eo(G(P(l)));let r=Math.min(...a),i=Math.max(...a);eh(G(P(r))),eu(G(P(i))),ef("".concat(Math.min(...t)," days")),ej("".concat(Math.max(...t)," days"))}}},[m]);let eg=(e,a)=>({x:Object.keys(e),y:Object.values(e),type:"scatter",mode:"lines+markers",name:a});(0,o.useEffect)(()=>{if(m&&C){let e=m[C];U([eg(e.cornHeatUnits,"CHU"),eg(e.GDD0,"GDD - Base Temp. 0\xb0C"),eg(e.GDD5,"GDD - Base Temp. 5\xb0C"),eg(e.GDD10,"GDD - Base Temp. 10\xb0C"),eg(e.GDD15,"GDD - Base Temp. 15\xb0C")])}},[C,m]),(0,o.useEffect)(()=>{if(m&&j){let e=m[j].weatherData;if(e.length>0){let a=[Array(52).fill(0),Array(52).fill(0),Array(52).fill(0)],t=Array(52).fill(0),s=e.map(e=>e.datetime),l=e.map(e=>e.precip),r=e.map(e=>e.humidity),i=e.map(e=>e.dew);s.forEach((e,s)=>{let n=Math.min(51,Math.floor(s/7));a[0][n]+=l[s],a[1][n]+=r[s],a[2][n]+=i[s],t[n]+=1}),a.forEach((e,s)=>{a[s]=e.map((e,a)=>t[a]>0?e/t[a]:0)});let n=Array.from({length:52},(e,a)=>a+1),c=n.map(e=>A(e));N({precip:a[0],humidity:a[1],dew:a[2],xValues:n,xNames:c})}}},[j,m]);let eb=(0,o.useCallback)(T()(e=>{let a=e["xaxis.range"];void 0!==a&&M([Math.max(0,Math.round(a[0])),Math.min(51,Math.round(a[1]))])},1e3),[]);return(0,o.useEffect)(()=>{if(w&&b){let[e,a]=w,t=S(b.precip.slice(e,a+1)),s=S(b.humidity.slice(e,a+1));console.log(t,s);let l=S(b.dew.slice(e,a+1)),r=D(b.precip.slice(e,a+1)),i=D(b.humidity.slice(e,a+1)),n=D(b.dew.slice(e,a+1));a-e+1>0?F({precip:"".concat(t.toFixed(2)," \xb1 ").concat(r.toFixed(2)),humidity:"".concat(s.toFixed(2)," \xb1 ").concat(i.toFixed(2)),dew:"".concat(l.toFixed(2)," \xb1 ").concat(n.toFixed(2))}):F({precip:"",humidity:"",dew:""})}},[w,b]),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"".concat(d().className," text-accent-dark text-2xl pb-2"),children:"Climate"}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Precipitation, Humidity & Dew"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%]",children:(0,s.jsxs)("div",{className:"mt-8 p-4 mx-4",children:[(0,s.jsxs)("div",{className:"".concat(n().className," mb-4 flex justify-between"),children:[(0,s.jsx)("div",{children:"Summary of Selected Range"}),b&&w&&(0,s.jsxs)("div",{children:[b.xNames[w[0]].split(" - ")[0]," - ",b.xNames[w[1]].split(" - ")[1]]})]}),w&&E&&b&&(0,s.jsx)("div",{className:"",children:(0,s.jsx)(y,{headers:["Climate Variable","Average Over Selected Range"],data:[{v:"Precipitation",a:E.precip},{v:"Humidity",a:E.humidity},{v:"Dew",a:E.dew}]})})]})}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row justify-center items-center",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center text-center",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-8"),children:"Daily Average For Each Week of"}),f&&(0,s.jsx)("div",{className:"w-56",children:(0,s.jsx)(k.ZP,{value:null!=j?j:f[0],onChange:(e,a)=>g(a),min:Math.min(...f),max:Math.max(...f),step:1,marks:f.map(e=>({value:e,label:e===Math.min(...f)||e===Math.max(...f)||e===j?e.toString():""})),valueLabelDisplay:"auto"})})]}),(0,s.jsx)("div",{className:"",children:b&&(0,s.jsx)(B,{data:[{z:[b.precip],x:b.xNames,y:[0],type:"heatmap",colorscale:"Blues",colorbar:{len:.3,y:.15},showscale:!0},{z:[b.humidity],x:b.xNames,y:[1],type:"heatmap",colorscale:"Greens",colorbar:{len:.3,y:.5},showscale:!0},{z:[b.dew],x:b.xNames,y:[2],type:"heatmap",colorscale:"Purples",colorbar:{len:.3,y:.85},showscale:!0}],layout:{xaxis:{title:"Range Selection",tickvals:b.xNames.filter((e,a)=>a%4==0),rangeslider:{visible:!0},range:w},yaxis:{title:"",tickvals:[0,1,2],ticktext:["Precipitation (mm)","Humidity (%)","Dew (\xb0C)"]},margin:{t:10,b:100,l:120,r:0}},style:{width:"100%",height:"100%"},onRelayout:eb})})]})})]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Temperature Suitability"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%]",children:(0,s.jsxs)("div",{className:"mt-8 p-4 mx-4",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4"),children:"End of Completed Season Averages"}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Corn Heat Units (CHUs):"}),(0,s.jsx)("div",{children:"".concat(_," \xb1 ").concat(I)})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{children:"Growind Degree Days (GDDs)"}),(0,s.jsx)("div",{children:"Base Temp. 0\xb0C"})]}),(0,s.jsx)("div",{children:"".concat(H," \xb1 ").concat(z)})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{children:"Growind Degree Days (GDDs)"}),(0,s.jsx)("div",{children:"Base Temp. 5\xb0C"})]}),(0,s.jsx)("div",{children:"".concat(Z," \xb1 ").concat(q)})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{children:"Growind Degree Days (GDDs)"}),(0,s.jsx)("div",{children:"Base Temp. 10\xb0C"})]}),(0,s.jsx)("div",{children:"".concat(Q," \xb1 ").concat(X)})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{children:"Growind Degree Days (GDDs)"}),(0,s.jsx)("div",{children:"Base Temp. 15\xb0C"})]}),(0,s.jsx)("div",{children:"".concat(ea," \xb1 ").concat(es)})]})]})}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row justify-center items-center",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center text-center",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-8"),children:"Year:"}),f&&(0,s.jsx)("div",{className:"w-56",children:(0,s.jsx)(k.ZP,{value:null!=C?C:f[0],onChange:(e,a)=>O(a),min:Math.min(...f),max:Math.max(...f),step:1,marks:f.map(e=>({value:e,label:e===Math.min(...f)||e===Math.max(...f)||e===C?e.toString():""})),valueLabelDisplay:"auto"})})]}),(0,s.jsx)("div",{className:"",children:Y&&(0,s.jsx)(B,{data:Y,layout:{xaxis:{title:"Date"},yaxis:{title:"Cumulative Heat Units"},margin:{t:20,b:40,l:60,r:20},legend:{x:.02,y:.98,xanchor:"left",yanchor:"top",orientation:"v",bgcolor:"rgba(255, 255, 255, 0.5)"}},style:{width:"100%",height:"100%"}})})]})})]})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg "),children:"Growing Season Length"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-[40%]",children:(0,s.jsxs)("div",{className:"mt-8 mx-4",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4"),children:"Summary"}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Earliest First Frost Date:"}),(0,s.jsx)("div",{children:en})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Latest First Frost Date:"}),(0,s.jsx)("div",{children:ed})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Earliest Last Frost Date:"}),(0,s.jsx)("div",{children:em})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Lastest Last Frost Date:"}),(0,s.jsx)("div",{children:ex})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Shortest Growing Season:"}),(0,s.jsx)("div",{children:ev})]}),(0,s.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,s.jsx)("div",{className:"",children:"Longest Growing Season:"}),(0,s.jsx)("div",{children:ep})]})]})}),(0,s.jsx)("div",{className:"w-[60%]",children:(0,s.jsxs)("div",{className:"flex-row",children:[(0,s.jsx)("div",{className:"".concat(n().className," w-full text-center"),children:"Completed Growing Seasons"}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(B,{data:[{x:er.map(e=>e.year),y:er.map(e=>e.start),type:"bar",orientation:"v",marker:{color:"rgba(0,0,0,0)"},showlegend:!1,hoverinfo:"skip"},{x:er.map(e=>e.year),y:er.map(e=>e.length),type:"bar",orientation:"v",hoverinfo:"text",text:er.map(e=>"Year: ".concat(e.year,"<br>Growing Season Length: ").concat(e.length," days<br>Last Frost Date: ").concat(e.lastFrost,"<br>First Frost Date: ").concat(e.firstFrost)),textposition:"none",marker:{color:"green"},showlegend:!1}],layout:{barmode:"stack",xaxis:{title:"Year",zeroline:!1,tickvals:er.map(e=>e.year),range:[Math.min(...er.map(e=>e.year))-.8,Math.max(...er.map(e=>e.year))+.8]},yaxis:{title:"Date",tickvals:Array.from({length:Math.round(12.166666666666666)},(e,a)=>30*a),ticktext:Array.from({length:Math.round(12.166666666666666)},(e,a)=>P(30*a)),range:[0,365]},margin:{t:0,b:40,l:100,r:0}},style:{width:"100%",height:"100%"}})})]})})]})]})]})};function _(e){let{legend:a}=e;return(0,s.jsxs)("div",{className:"",children:[(0,s.jsx)("div",{className:"".concat(d().className," text-center mb-2 font-medium"),children:"Legend"}),Object.keys(a).map(e=>(0,s.jsxs)("div",{className:"legend-item flex items-center mb-1",children:[(0,s.jsx)("span",{className:"legend-color block w-4 h-4 mr-2",style:{backgroundColor:a[e]}}),(0,s.jsx)("span",{className:"legend-label",children:e})]},e))]})}var L=t(3223),I=e=>{let{windDirection:a,windDirectionStdDev:t}=e,l=Math.round(a),r=Math.round(t);return(0,s.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute",children:(0,s.jsx)(L.Z,{className:"text-blue-600 h-40 w-40 pb-20",style:{transform:"rotate(".concat(l,"deg)")}})}),(0,s.jsx)("div",{className:"absolute",children:(0,s.jsx)(L.Z,{className:"text-blue-400 h-20 w-20 pb-10",style:{transform:"rotate(".concat(l+r,"deg)")}})}),(0,s.jsx)("div",{className:"absolute",children:(0,s.jsx)(L.Z,{className:"text-blue-400 h-20 w-20 pb-10",style:{transform:"rotate(".concat(l-r,"deg)")}})})]})};function W(e,a,t,s,l,r){let i=document.createElement("canvas");i.width=a,i.height=t;let n=i.getContext("2d");if(!n)throw Error("Failed to get canvas 2D context");let c=n.createImageData(a,t);if(e.forEach((e,a)=>{if(e===s||null===e)c.data[4*a+3]=0;else{let t=l(e).rgb();c.data[4*a]=t[0],c.data[4*a+1]=t[1],c.data[4*a+2]=t[2],c.data[4*a+3]=255}}),1===r)return i.toDataURL();n.putImageData(c,0,0);let d=document.createElement("canvas");d.width=a*r,d.height=t*r;let o=d.getContext("2d");if(!o)throw Error("Failed to get scaled canvas 2D context");return o.imageSmoothingEnabled=!1,o.drawImage(i,0,0,d.width,d.height),d.toDataURL()}let H=(0,x.default)(()=>Promise.all([t.e(733),t.e(212),t.e(969)]).then(t.bind(t,1969)),{loadableGenerated:{webpack:()=>[1969]},ssr:!1}),R=["#6A0DAD","#228B22","#FFD700","#8B0000"];var z=e=>{var a;let{lat:t,lng:l,rasterDataCache:r,elevationData:i,cropHeatMaps:c,yearlyYields:m,climateData:h,score:x,setScore:u}=e,[v,p]=(0,o.useState)([]),[g,w]=(0,o.useState)(null),[M,E]=(0,o.useState)(null),[F,C]=(0,o.useState)(null),[P,O]=(0,o.useState)(null),[G,A]=(0,o.useState)(null),[Y,T]=(0,o.useState)("Elevation"),[B,U]=(0,o.useState)(null),[L,z]=(0,o.useState)(null),[V,Z]=(0,o.useState)(null),[J,q]=(0,o.useState)(""),[K,Q]=(0,o.useState)(null);return(0,o.useEffect)(()=>{if(r){let e=Object.keys(r).map(Number);p(e),null===g&&w(e[0]);let a=Object.keys(r).length,{totalUsableLandPct:t,totalArea:s}=Object.values(r).reduce((e,a)=>(a.usableLandPct&&(e.totalUsableLandPct+=a.usableLandPct,e.totalArea+=a.area),e),{totalUsableLandPct:0,totalArea:0});A(t/a),O(s/a*900)}},[r]),(0,o.useEffect)(()=>{if(i&&Y)switch(Y){case"Elevation":U({imageUrl:i.elevationUrl,min:i.minElevation,max:i.maxElevation});break;case"Slope":U({imageUrl:i.slopeUrl,min:i.minSlope,max:i.maxSlope});break;case"Convexity":U({imageUrl:i.convexityUrl,min:i.minConvexity,max:i.maxConvexity})}},[i,Y]),(0,o.useEffect)(()=>{if(h)for(let a of Object.keys(h).map(e=>Number(e)).sort((e,a)=>a-e)){var e;let t=null===(e=h[a])||void 0===e?void 0:e.weatherData;if(t&&t.length>=365){z({dir:t.map(e=>e.winddir),speed:t.map(e=>e.windspeed),gust:t.map(e=>e.windgust)});break}}},[h]),(0,o.useEffect)(()=>{(async()=>{if(L&&i){let{aspect:e,slope:a}=i,t=(e,a,t,s)=>a*Math.cos(Math.PI/180*Math.abs(e-t))*s,s=[],l=[],r=0,n=0,c=0,d=0;a.forEach((a,i)=>{let o=e[i];if(a&&o){let e=180/Math.PI*Math.atan(a)/90,i=S(L.dir.map((a,s)=>t(o,e,a,L.speed[s]))),m=S(L.dir.map((a,s)=>t(o,e,a,L.gust[s])));s.push(i),l.push(m),r=Math.min(r,i),n=Math.max(n,i),c=Math.min(c,m),d=Math.max(d,m)}else s.push(null),l.push(null)});let o=S(L.dir),m=D(L.dir),h=S(L.speed),x=D(L.speed),u=S(L.gust),v=D(L.gust),f=b().scale(R).domain([r,n]),p=await W(s,i.width-2,i.height-2,null,f,15),j=b().scale(R).domain([c,d]);Z({windSpeedExposureUrl:p,windGustExposureUrl:await W(l,i.width-2,i.height-2,null,j,15),avgWindDir:o,stdWindDir:m,avgWindSpeed:h,stdWindSpeed:x,avgWindGust:u,stdWindGust:v,minSpeedExposure:r,maxSpeedExposure:n,minGustExposure:c,maxGustExposure:d,bbox:i.bbox}),q("Speed")}})()},[L,i]),(0,o.useEffect)(()=>{if(console.log("Wind Exposure:",V),J&&V)switch(J){case"Speed":Q({imageUrl:V.windSpeedExposureUrl,min:V.minSpeedExposure,max:V.maxSpeedExposure});break;case"Gust":Q({imageUrl:V.windGustExposureUrl,min:V.minGustExposure,max:V.maxGustExposure})}},[J,V]),(0,o.useEffect)(()=>{null!==g&&r&&E(r[g])},[g,r]),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"".concat(d().className," text-accent-dark text-2xl pb-2"),children:"Topography"}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg"),children:"Size & Layout"}),M?(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-[40%] mt-8 p-4",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Summary"}),(0,s.jsx)(y,{headers:["Land Section","% of Land","Area (m\xb2)","Area (ac)"],data:[{a:"Total Property",p:"100",a1:"".concat(null!==(a=null==P?void 0:P.toFixed(2))&&void 0!==a?a:""),a2:"".concat(((null!=P?P:0)/4046.8565).toFixed(2))},{a:"Historical Cropland",p:"".concat(((null!=G?G:0)*100).toFixed(2)),a1:"".concat(((null!=P?P:0)*(null!=G?G:0)).toFixed(2)),a2:"".concat(((null!=P?P:0)/4046.8565*(null!=G?G:0)).toFixed(2))},{a:"Other",p:"".concat(((1-(null!=G?G:0))*100).toFixed(2)),a1:"".concat(((null!=P?P:0)*(1-(null!=G?G:0))).toFixed(2)),a2:"".concat(((null!=P?P:0)/4046.8565*(1-(null!=G?G:0))).toFixed(2))}]})]}),(0,s.jsx)("div",{className:"w-[60%] flex-row",children:(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"flex-row w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center h-16",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-8"),children:"Year:"}),(0,s.jsx)("div",{className:"w-56",children:(0,s.jsx)(k.ZP,{value:null!=g?g:v[0],onChange:(e,a)=>w(a),min:Math.min(...v),max:Math.max(...v),step:1,marks:v.map(e=>({value:e,label:e===Math.min(...v)||e===Math.max(...v)||e===g?e.toString():""})),valueLabelDisplay:"auto"})})]}),(0,s.jsx)(H,{latitude:t,longitude:l,zoom:15,bbox:M.bbox,imageUrl:M.imageUrl})]}),(0,s.jsx)("div",{className:"ml-2 mt-8",children:(0,s.jsx)(_,{legend:M.legend})})]})})]}):(0,s.jsx)(j,{})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg"),children:"Elevation"}),i&&B?(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-[40%] p-4 mt-8",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Summary"}),(0,s.jsx)(y,{headers:["Elevation View","Average"],data:[{view:"Elevation",avg:"".concat(i.avgElevation.toFixed(2)," \xb1 ").concat(i.stdElevation.toFixed(2))},{view:"Slope",avg:"".concat(i.avgSlope.toFixed(5)," \xb1 ").concat(i.stdSlope.toFixed(5))},{view:"Convexity",avg:"".concat(i.avgConvexity.toFixed(5)," \xb1 ").concat(i.stdConvexity.toFixed(5))}]})]}),(0,s.jsx)("div",{className:"w-[60%] flex-row",children:(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center h-16",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-4"),children:"Elevation View:"}),(0,s.jsx)(f,{options:["Elevation","Slope","Convexity"],selected:Y,onSelect:e=>T(e)})]}),(0,s.jsx)(H,{latitude:t,longitude:l,zoom:15,bbox:i.bbox,imageUrl:B.imageUrl})]}),(0,s.jsxs)("div",{className:"flex-row ml-2 justify-start items-center mt-16",children:[(0,s.jsx)("div",{className:"".concat(d().className," mb-2 text-center"),children:Y}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(N,{vmin:B.min,vmax:B.max,numIntervals:5,heatmapColors:R})})]})]})})]}):(0,s.jsx)(j,{})]}),(0,s.jsxs)("div",{className:"py-4 border-b border-gray-500",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-lg"),children:"Wind Exposure"}),V&&K?(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-[40%] p-4 mt-8",children:[(0,s.jsx)("div",{className:"".concat(n().className," mb-4 mx-4"),children:"Summary"}),(0,s.jsx)(y,{headers:["Exposure Type","Average"],data:[{type:"Wind Speed",avg:"".concat(V.avgWindSpeed.toFixed(2)," \xb1 ").concat(V.stdWindSpeed.toFixed(2))},{type:"Wind Gust",avg:"".concat(V.avgWindGust.toFixed(2)," \xb1 ").concat(V.stdWindGust.toFixed(2))}]}),(0,s.jsxs)("div",{className:"flex-row justify-center mx-4",children:[(0,s.jsx)("div",{className:"w-full mb-20",children:"Average Wind Direction (and Standard Deviation):"}),V.avgWindDir&&V.stdWindDir&&(0,s.jsx)("div",{className:"h-20",children:(0,s.jsx)(I,{windDirection:V.avgWindDir,windDirectionStdDev:V.stdWindDir})})]})]}),(0,s.jsx)("div",{className:"w-[60%] flex-row",children:(0,s.jsxs)("div",{className:"flex w-full",children:[(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex justify-center items-center h-16",children:[(0,s.jsx)("div",{className:"".concat(n().className," mr-4"),children:"Wind Exposure Type:"}),(0,s.jsx)(f,{options:["Speed","Gust"],selected:J,onSelect:e=>q(e)})]}),(0,s.jsx)(H,{latitude:t,longitude:l,zoom:15,bbox:V.bbox,imageUrl:K.imageUrl})]}),(0,s.jsxs)("div",{className:"flex-row ml-2 justify-start items-center mt-16",children:[(0,s.jsx)("div",{className:"".concat(d().className," mb-2 text-center"),children:"Exposure"}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)(N,{vmin:K.min,vmax:K.max,numIntervals:5,heatmapColors:R})})]})]})})]}):(0,s.jsx)(j,{})]})]})};let V={0:"Cloud",10:"Cloud",20:"Water",30:"Barren",34:"Developed",35:"Greenhouses",50:"Shrubland",80:"Wetland",85:"Peatland",110:"Grassland",120:"Agriculture",122:"Flaxseed",130:"Too Wet",131:"Fallow",132:"Cereals",133:"Barley",134:"Mustard",135:"Millet",136:"Oats",137:"Rye",138:"Spelt",139:"Triticale",140:"Wheat",141:"Switchgrass",142:"Sorghum",143:"Quinoa",145:"Winter Wheat",146:"Spring Wheat",147:"Corn",148:"Tobacco",149:"Ginseng",150:"Oilseeds",151:"Borage",152:"Camelina",153:"Canola",154:"Flaxseed2",155:"Mustard",156:"Safflower",157:"Sunflower",158:"Soybeans",160:"Pulses",161:"Other Pulses",162:"Peas",163:"Chickpeas",167:"Beans",168:"Fababeans",174:"Lentils",175:"Vegetables",176:"Tomatoes",177:"Potatoes",178:"Sugarbeets",179:"Other Veg",180:"Fruits",181:"Berries",182:"Blueberry",183:"Cranberry",185:"Other Berry",188:"Orchards",189:"Other Fruits",190:"Vineyards",191:"Hops",192:"Sod",193:"Herbs",194:"Nursery",195:"Buckwheat",196:"Canaryseed",197:"Hemp",198:"Vetch",199:"Other Crops",200:"Forest",210:"Coniferous",220:"Broadleaf",230:"Mixedwood"};var Z=t(2169);let J=["#6A0DAD","#228B22","#FFD700","#8B0000"],q=e=>{let[a,t]=(0,o.useState)({}),[s,l]=(0,o.useState)(null);return(0,o.useEffect)(()=>{let a=async()=>{try{let{image:a}=await Q("".concat(e,"/demo/raster_data/elevation.tif")),t=await ee(a);l(t)}catch(e){console.error("Error fetching raster data:",e)}};(async()=>{let a={};try{for(let t of[2014,2015,2016,2017,2018,2019,2020,2021]){let s="".concat(e,"/demo/raster_data/").concat(t,".tif"),{image:l}=await Q(s),r=await $(l);a[t]=r}t(e=>({...e,...a}))}catch(e){console.error("Error fetching raster data:",e)}})(),a()},[e]),{rasterDataCache:a,elevationData:s}},K=b().scale("Set1").colors(Object.keys(V).length),Q=async e=>{let a=await fetch(e);if(!a.ok)throw Error("Failed to fetch ".concat(e));let t=await a.arrayBuffer(),s=await (0,Z.go)(t);return{image:await s.getImage()}},$=async e=>{let a=Array.from((await e.readRasters())[0]),t={};a.forEach(e=>{t[e]=(t[e]||0)+1});let s=.02*a.length;a.forEach((e,l)=>{t[e]<s&&(a[l]=0)});let l=0,r=0,i=[];Object.keys(t).forEach(e=>{let a=parseInt(e),n=V[a];if(w.includes(n)){let e=t[a];r+=e,!i.includes(n)&&e>=s&&i.push(n)}0!=a&&(l+=t[a])});let n=r/l,c=l,d=e.getWidth(),o=e.getHeight(),m=await X(a,d,o),h=new Set(a),x={};return h.forEach(e=>{let a=V[e];if(a&&"Cloud"!==a){let t=Object.keys(V).findIndex(a=>parseInt(a)===e);x[a]=K[t]}}),{imageUrl:m,legend:x,bbox:e.getBoundingBox(),usableLandPct:n,area:c,majorCommodityCropsGrown:i}},X=(e,a,t)=>{let s=document.createElement("canvas");s.width=a,s.height=t;let l=s.getContext("2d");if(!l)throw Error("Failed to get canvas 2D context");l.imageSmoothingEnabled=!1;let r=l.createImageData(a,t);for(let a=0;a<e.length;a++){let t=e[a],s=Object.keys(V).findIndex(e=>parseInt(e)===t),[l,i,n]=(-1!==s?b()(K[s]):b()("black")).rgb();r.data[4*a]=l,r.data[4*a+1]=i,r.data[4*a+2]=n,r.data[4*a+3]=0===t||10===t?0:255}l.putImageData(r,0,0);let i=document.createElement("canvas");i.width=10*a,i.height=10*t;let n=i.getContext("2d");if(!n)throw Error("Failed to get scaled canvas 2D context");return n.imageSmoothingEnabled=!1,n.drawImage(s,0,0,i.width,i.height),i.toDataURL()},ee=async e=>{let a=Array.from((await e.readRasters())[0]),t=e.getWidth(),s=e.getHeight(),l=a.filter(e=>!isNaN(e)&&null!==e&&0!==e),r=Math.min(...l),i=Math.max(...l),n=S(l),c=D(l),d=b().scale(J).domain([r,i]),o=await W(a,t,s,0,d,10),{slope:m,minSlope:h,maxSlope:x,avgSlope:u,stdSlope:v,aspect:f}=function(e,a,t){let s=[],l=[],r=1e6,i=0;function n(t,s){var l;return null!==(l=e[t*a+s])&&void 0!==l?l:NaN}for(let e=1;e<t-1;e++)for(let t=1;t<a-1;t++){let a=n(e,t),c=n(e,t-1),d=n(e,t+1),o=n(e-1,t),m=n(e+1,t);if([a,c,d,o,m].some(e=>0===e)){s.push(null),l.push(null);continue}let h=(d-c)/60,x=(m-o)/60,u=Math.sqrt(Math.pow(h,2)+Math.pow(x,2)),v=180/Math.PI*Math.atan2(x,h),f=v>=0?v:v+360;isNaN(u)?(console.warn("Invalid slope value at",{i:e,j:t,overallSlope:u}),s.push(null),l.push(null)):(u<r&&(r=u),u>i&&(i=u),s.push(u),l.push(f))}let c=S(s),d=D(s);return{slope:s,minSlope:r,maxSlope:i,avgSlope:c,stdSlope:d,aspect:l}}(a,t,s),p=b().scale(J).domain([h,x]),j=await W(m,t-2,s-2,null,p,10),{convexity:g,minConvexity:N,maxConvexity:y,avgConvexity:w,stdConvexity:M}=function(e,a,t){let s=[],l=1e6,r=0;function i(t,s){var l;return null!==(l=e[t*a+s])&&void 0!==l?l:NaN}for(let e=1;e<t-1;e++)for(let t=1;t<a-1;t++){let a=i(e,t),n=i(e,t-1),c=i(e,t+1),d=i(e-1,t),o=i(e+1,t);if([a,n,c,d,o].some(e=>0===e)){s.push(null);continue}let m=(c-2*a+n)/900+(o-2*a+d)/900;m<l&&(l=m),m>r&&(r=m),s.push(m)}let n=S(s),c=D(s);return{convexity:s,minConvexity:l,maxConvexity:r,avgConvexity:n,stdConvexity:c}}(a,t,s),E=b().scale(J).domain([N,y]),F=await W(g,t-2,s-2,null,E,10);return{bbox:e.getBoundingBox(),slope:m,aspect:f,width:t,height:s,elevationUrl:o,avgElevation:n,stdElevation:c,minElevation:r,maxElevation:i,slopeUrl:j,avgSlope:u,stdSlope:v,minSlope:h,maxSlope:x,convexityUrl:F,avgConvexity:w,stdConvexity:M,minConvexity:N,maxConvexity:y}},ea={Flaxseed:{vmin:56,vmax:96},Wheat:{vmin:77,vmax:117},Barley:{vmin:61,vmax:101},Oats:{vmin:56,vmax:96},Canola:{vmin:43,vmax:83},Peas:{vmin:66,vmax:106},Corn:{vmin:63,vmax:103},Soy:{vmin:63,vmax:103}},et=e=>{let[a,t]=(0,o.useState)({});return(0,o.useEffect)(()=>{Promise.all(w.map(a=>new Promise((s,l)=>{let r=new Image;r.src="".concat(e,"/demo/crop_heat_maps/").concat(a,".png"),r.onload=()=>{let e=document.createElement("canvas"),l=e.getContext("2d");if(!l)throw Error("Failed to get canvas 2D context");e.width=r.width,e.height=r.height,l.drawImage(r,0,0);let i=l.getImageData(0,0,e.width,e.height),n=i.data;setTimeout(()=>{let{min:c,max:d,average:o,stdDev:m,range:h,thresholdMin:x,thresholdMax:u}=es(n,a);l.putImageData(i,0,0);let v=document.createElement("canvas");v.width=10*r.width,v.height=10*r.height;let f=v.getContext("2d");if(!f)throw Error("Failed to get scaled canvas 2D context");f.imageSmoothingEnabled=!1,f.drawImage(e,0,0,v.width,v.height);let p=v.toDataURL();t(e=>({...e,[a]:{imageUrl:p,min:c,max:d,average:o,stdDev:m,range:h,thresholdMin:x,thresholdMax:u}})),s()},0)},r.onerror=()=>{console.error("Failed to load image for ".concat(a)),l()}}))).catch(e=>console.error("Error preloading and processing images:",e))},[e]),a},es=(e,a)=>{let t=b().scale(["black","red","yellow","white"]).correctLightness().domain([0,1]),s=[],{vmin:l,vmax:r}=ea[a],i=r-l;for(let a=0;a<e.length;a+=4){let r=(e[a]+e[a+1]+e[a+2])/3/255;s.push(r*i+l);let n=t(r).rgb();e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2]}let n=Math.min(...s),c=Math.max(...s),d=S(s),o=D(s);return(isNaN(n)||isNaN(c)||isNaN(d)||isNaN(o))&&console.error("processData is returning NaN values"),{min:n,max:c,average:d,stdDev:o,range:i,thresholdMin:l,thresholdMax:r}};var el=t(8355),er=t.n(el);let ei=e=>{let[a,t]=(0,o.useState)([]);return(0,o.useEffect)(()=>{(async()=>{let a=await fetch("".concat(e,"/demo/yearly_crop_yields.csv")),s=await a.text();t(er().parse(s,{header:!0,dynamicTyping:!0}).data)})()},[]),a},en=e=>{let[a,t]=(0,o.useState)({}),[s,l]=(0,o.useState)(!0);(0,o.useEffect)(()=>{er().parse("".concat(e,"/demo/weather.csv"),{download:!0,header:!0,dynamicTyping:!0,complete:e=>{r(e.data.map(e=>({datetime:e.datetime,tempmin:parseFloat(e.tempmin),tempmax:parseFloat(e.tempmax),temp:parseFloat(e.temp),precip:parseFloat(e.precip),humidity:parseFloat(e.humidity),dew:parseFloat(e.dew),windgust:parseFloat(e.windgust),windspeed:parseFloat(e.windspeed),winddir:parseFloat(e.winddir)}))),l(!1)}})},[]);let r=e=>{let a={},s=e.reduce((e,a)=>{if(a.datetime){let t=parseInt(a.datetime.substring(0,4));e[t]||(e[t]=[]),e[t].push(a)}return e},{});Object.keys(s).forEach(e=>{let t=parseInt(e),{firstFrost:l,lastFrost:r,growingSeasonLength:d}=i(s[t]);a[t]={weatherData:s[t],firstFrost:l,lastFrost:r,growingSeasonLength:d,cornHeatUnits:n(s[t]),GDD0:c(s[t],0),GDD5:c(s[t],5),GDD10:c(s[t],10),GDD15:c(s[t],15)}}),t(a)},i=e=>{var a,t;let s=e.filter(e=>e.tempmin<=0),l=new Date("".concat(e[0].datetime.substring(0,4),"-07-01")),r=s.filter(e=>new Date(e.datetime)<l),i=s.filter(e=>new Date(e.datetime)>l),n=(null===(a=r.reduce((e,a)=>Math.abs(new Date(a.datetime).getTime()-l.getTime())<Math.abs(new Date(e.datetime).getTime()-l.getTime())?a:e,r[0]))||void 0===a?void 0:a.datetime)||null,c=(null===(t=i.reduce((e,a)=>Math.abs(new Date(a.datetime).getTime()-l.getTime())<Math.abs(new Date(e.datetime).getTime()-l.getTime())?a:e,i[0]))||void 0===t?void 0:t.datetime)||null,d=null;if(c&&n){let e=new Date(c),a=new Date(n);d=Math.ceil((e.getTime()-a.getTime())/864e5)}return{firstFrost:c,lastFrost:n,growingSeasonLength:d}},n=e=>{let a={},t=0;return e.forEach(e=>{let s=Math.min(e.tempmax,30),l=(1.8*(e.tempmin-4.4)+3.33*(s-10)-.084*Math.pow(s-10,2))/2;t+=Math.max(0,l),a[e.datetime]=t,e.tempmin<4.4||(t+=Math.max(0,l)),a[e.datetime]=t}),a},c=(e,a)=>{let t={},s=0;return e.forEach(e=>{let l=(e.tempmax+e.tempmin)/2;s+=Math.max(0,l-a),t[e.datetime]=s}),t};return a},ec="/landwise_analytica",ed={street_number:"8159",route:"Side Road 30",locality:"Rockwood",administrative_area_level_3:"Centre Wellington",administrative_area_level_2:"Wellington County",administrative_area_level_1:"ON",country:"CA",postal_code:"N0B 2K0"};function eo(){let e="43.6929954",a="-80.3071343",[t,l]=(0,o.useState)(null),[i,c]=(0,o.useState)(null),[x,u]=(0,o.useState)(null),[f,p]=(0,o.useState)("EstimatedYield"),{rasterDataCache:j,elevationData:g}=q(ec),b=et(ec),N=ei(ec),y=en(ec);return(0,s.jsx)("div",{className:"".concat(r().className," bg-accent-light text-black"),children:(0,s.jsx)("div",{className:"relative m-4",children:(0,s.jsxs)(m,{className:"mb-4",children:[(0,s.jsxs)("section",{id:"summary",children:[(0,s.jsx)("div",{className:"".concat(n().className," text-accent text-2xl mb-2 w-full text-center"),children:"THIS IS A DEMO REPORT!"}),(0,s.jsx)("div",{className:"".concat(d().className," text-accent-dark text-3xl pb-2"),children:"Summary"}),(0,s.jsxs)("div",{className:"w-full sm:flex flex-row",children:[(0,s.jsxs)("div",{className:"w-[44%] p-4 mx-12",children:[(0,s.jsx)("div",{className:"".concat(n().className," flex justify-between mb-2 text-2xl"),children:"Property"}),(0,s.jsx)(h,{addressComponents:ed,latitude:e,longitude:a})]}),(0,s.jsx)("div",{className:"w-[56%] p-4",children:(0,s.jsx)(v,{})})]})]}),(0,s.jsx)("div",{className:"flex justify-center space-x-8 border-b border-accent-dark mb-4 mt-10",children:["EstimatedYield","Climate","Topography"].map(e=>(0,s.jsx)("button",{onClick:()=>p(e),className:"py-2 px-4 w-48 rounded-t-lg ".concat(f===e?"bg-accent-dark text-white":"text-black"," hover:bg-accent-dark hover:opacity-75 hover:text-white"),children:e.replace(/([A-Z])/g," $1")},e))}),(0,s.jsx)("div",{children:(()=>{switch(f){case"EstimatedYield":return(0,s.jsx)(C,{lat:e,lng:a,rasterDataCache:j,elevationData:g,cropHeatMaps:b,yearlyYields:N,climateData:y,score:t,setScore:l});case"Climate":return(0,s.jsx)(U,{lat:e,lng:a,rasterDataCache:j,elevationData:g,cropHeatMaps:b,yearlyYields:N,climateData:y,score:i,setScore:c});case"Topography":return(0,s.jsx)(z,{lat:e,lng:a,rasterDataCache:j,elevationData:g,cropHeatMaps:b,yearlyYields:N,climateData:y,score:x,setScore:u});default:return null}})()})]})})})}}},function(e){e.O(0,[639,571,971,23,744],function(){return e(e.s=7225)}),_N_E=e.O()}]);